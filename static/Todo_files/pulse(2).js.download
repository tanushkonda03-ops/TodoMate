(()=>{var e={682:e=>{var t=function(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};t.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},t.prototype.init_by_array=function(e,t){var n,r,i;for(this.init_seed(19650218),n=1,r=0,i=this.N>t?this.N:t;i;i--){var s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+e[r]+r,this.mt[n]>>>=0,r++,++n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),r>=t&&(r=0)}for(i=this.N-1;i;i--){s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-n,this.mt[n]>>>=0,++n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1)}this.mt[0]=2147483648},t.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_seed(5489),n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[1&e];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},t.prototype.random_int31=function(){return this.random_int()>>>1},t.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},t.prototype.random=function(){return this.random_int()*(1/4294967296)},t.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},t.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)},e.exports=t}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{key;___;constructor(e){if(this.key=e,"string"!=typeof e||!e.trim())throw new Error("Invalid InjectionToken name!");this.___=e}}const t=new e("PULSE_ROOT_CONFIGURATION");let r;function i(){const e=function(){if(r)return r;try{if("object"==typeof navigator&&"Cloudflare-Workers"===navigator?.userAgent)return r="cf-worker",r;if("undefined"!=typeof window&&void 0!==window.document)return"object"==typeof navigator&&navigator?.userAgent?.includes("jsdom")?(r="jsdom",r):(r="browser",r);if("undefined"!=typeof process&&process.versions?.node)return r="node",r;if("undefined"!=typeof globalThis&&"function"==typeof globalThis.addEventListener&&"function"==typeof globalThis.Request){if("EdgeRuntime"in globalThis&&"edge"===globalThis.EdgeRuntime)return r="vercel-edge",r;if("undefined"!=typeof WebSocket)return r="cf-worker",r}}catch{console.warn("Failed to detect environment")}return r="unknown",r}();return"browser"===e||"jsdom"===e}let s=null;const o=e=>{if(null!==s)return s;try{if(void 0===e||!("localStorage"in e)||!e.localStorage.getItem)return!1;const t="__test__";return e.localStorage.setItem(t,"1"),e.localStorage.removeItem(t),s=!0,!0}catch{return s=!1,!1}};let a=null;function c(e,t=!1){if(null!==a)return t?Promise.resolve(a):a;if(void 0===e||!e.indexedDB)return a=!1,!!t&&Promise.resolve(!1);try{const n=e?.indexedDB?.open("testDB");return t?new Promise(t=>{n.onsuccess=()=>{n.result.close(),e.indexedDB.deleteDatabase("testDB"),a=!0,t(!0)},n.onerror=()=>{a=!1,t(!1)}}):(n.onsuccess=()=>{n.result.close(),e.indexedDB.deleteDatabase("testDB"),a=!0},n.onerror=()=>{a=!1},!0)}catch{return a=!1,!!t&&Promise.resolve(!1)}}class u{task;resolveTask;rejectTask;completed=!1;constructor(e){if(this.task=new Promise((e,t)=>{this.resolveTask=e,this.rejectTask=t}),e){const t=setTimeout(()=>{this.reject(new Error(`AsyncTask timeout after ${e}ms!`))},e);this.waitUntilResolved().then(()=>clearTimeout(t)).catch(()=>clearTimeout(t))}}resolve(e){this.completed||(this.completed=!0,this.resolveTask(e))}reject(e){this.completed||(this.completed=!0,this.rejectTask(e))}waitUntilResolved(){return this.task}}class l{parent;providers=new Map;store=new Map;tasks=new Map;constructor(e){this.parent=e}register(...e){for(const t of e)this.providers.set(t.provide,t);return this}factory(e){return this.providers.set(e.provide,e),this}get(e){const t=this.getOrCreate(e);return this.isPromise(t)?t:Promise.resolve(t)}getSync(e){const t=this.getOrCreate(e);if(this.isPromise(t)){const t=this.typeName(e);throw new Error(["Cannot instantiate dependency synchronously!",`One of the providers of the dependencies of '${t}' is asynchronous!`].join("\n"))}return t}getOrCreate(e){if(e===l)return this;const t=this.store.get(e);if(t)return t;let n=this.tasks.get(e);if(n)return n.waitUntilResolved();n=new u;const r=this.providers.get(e);if(!r){if(this.parent)return this.parent.getOrCreate(e);throw new Error(`No provider found for type '${this.typeName(e)}'!`)}const i=this.getDeps(r);if(this.isPromise(i))return this.tasks.set(e,n),i.then(e=>this.createValue(r,e)).then(t=>{this.store.set(e,t),n?.resolve(t),this.tasks.delete(e)}).catch(t=>{this.tasks.delete(e),n?.reject(t)}),n.waitUntilResolved();{const t=this.createValue(r,i);return this.store.set(e,t),t}}createValue(e,t){if(void 0!==e.useValue)return e.useValue;if(e.useClass)return new e.useClass(...t);if(e.useFactory)return e.useFactory(...t);if(this.isClass(e.provide))return new e.provide(...t);{const t=this.typeName(e.provide);throw new Error(`No useClass or useFactory is provided for type '${t}'`)}}getDeps(e){this.checkDeps(e);const t=(Array.isArray(e.deps)?e.deps:[]).map(e=>this.getOrCreate(e));return t.some(e=>this.isPromise(e))?Promise.all(t):t}checkDeps(e){const t=Array.isArray(e.deps)?e.deps:[],n=t.map(e=>this.findProvider(e)),r=t.filter((e,t)=>void 0===n[t]);if(!r.length)return;const i=this.typeName(e.provide),s=n.map(e=>e?this.typeName(e.provide):"?").join(", "),o=`No provider found for the following tokens: ${r.map(e=>this.typeName(e)).join(", ")}`;throw new Error(`Cannot instantiate dependency '${i}(${s})'!\n\n ${o}`)}findProvider(e){return this.providers.get(e)||this.parent?.findProvider(e)}typeName(t){return t instanceof e?`Token(${t.key})`:this.isClass(t)?t.name:String(t)}isClass(e){return e&&"function"==typeof e&&"string"==typeof e.name&&"function"==typeof e.constructor&&e.name}isPromise(e){return"object"==typeof e&&(e instanceof Promise||e.then&&e.catch)}}class h{providers=[];useClass(e,t,n,r){return this.providers.push({provide:e,useClass:t,deps:n,provideInRoot:r}),this}useFactory(e,t,n,r){return this.providers.push({provide:e,useFactory:t,deps:n,provideInRoot:r}),this}useValue(e,t,n){return this.providers.push({provide:e,useValue:t,provideInRoot:n}),this}_getProviders(){return this.providers}}class d{imports=[];builder=new h;beforeInitHandler;initHandler;injector=new l;parent;bootstrapped=!1;import(e){if(e.bootstrapped)throw new Error("Cannot import already bootstrapped module! Only root module must be bootstrapped!");return e.parent=this,this.imports.push(e),this}provide(e){const t=e(this.builder);if(!(t&&t instanceof h))throw new Error("Provide function must return the received ProviderBuilder instance!");return this.builder=t,this}beforeInit(e){if("function"!=typeof e)throw new Error("BeforeInit handler must be a function!");return this.beforeInitHandler=e,this}onInit(e,t){if("function"!=typeof e)throw new Error("OnInit handler must be a function!");if(t&&!Array.isArray(t))throw new Error("OnInit handler dependency list must be an array!");return this.initHandler={provide:"initializer",useFactory:e,deps:t||void 0},this}bootstrapStrict(e){return this.bootstrap(e)}async bootstrap(e){if(this.bootstrapped)throw new Error("PulseModule is already bootstrapped!");if(this.bootstrapped)throw new Error("Cannot bootstrap child module!");if(this.imports.some(e=>e.bootstrapped))throw new Error("Cannot import already bootstrapped module! Only root module must be bootstrapped!");const n=await this.runModulesBeforeInit(e),r=this.getConfigOverride(n),i={provide:t,useValue:r};return this.injector.register(i),await this.initializeModules(e),this.injector}getConfigOverride(e){try{if(i()&&"undefined"!=typeof window&&o(window)){const t=window.localStorage.getItem(`${e.storagePrefix}config_override`);if(t){const n=JSON.parse(t);return n&&"object"==typeof n?{...e,...n}:(console.error("Configuration entry must be an object!"),e)}}}catch(e){console.error("Pulse configuration provided through localStorage is invalid!"),console.log(e)}return e}async initializeModules(e){const t=[...this.imports,this];for(const e of t)e.configureInjector();const n=t.map(t=>t.runOnInit(e));await Promise.all(n)}configureInjector(){if(this.parent&&this.imports.length)throw new Error("Deep module imports are not supported yet!");const e=this.parent?.injector,t=e?new l(e):this.injector,n=this.builder._getProviders(),r=n.filter(e=>!1!==e.provideInRoot),i=n.filter(e=>!e.provideInRoot);t.register(...i),e?e.register(...r):r.length&&t.register(...r),this.injector=t}async runModulesBeforeInit(e){const t=await this.runBeforeInit(e),n=this.imports.map(t=>t.runBeforeInit(e));return{...t,...(await Promise.all(n)).reduce((e,t)=>({...e,...t}))}}async runBeforeInit(e){try{const t=this.beforeInitHandler?this.beforeInitHandler(e):void 0;return(t instanceof Promise?await t:t)||{}}catch(e){throw console.error("Module beforeInit hook failed!"),e}}async runOnInit(e){try{if(!this.initHandler?.useFactory)return;const t=(this.initHandler.deps||[]).map(e=>this.injector.get(e)),n=await Promise.all(t),r=this.initHandler.useFactory(e,...n);r instanceof Promise&&await r}catch(e){throw console.error(e),console.error("Module onInit hook failed!"),e}}}class p{getElementAttributes(e){const t=["class","value","id","name"];return Array.from(e.attributes).map(e=>({name:e.name,value:e.value})).filter(e=>-1===t.indexOf(e.name))}getElementText(e){return e instanceof HTMLAnchorElement||e instanceof HTMLButtonElement?e.innerText:e instanceof HTMLInputElement&&("button"===e.type||"submit"===e.type||"reset"===e.type)?e.value:e===document.body?"<body>":e===document.documentElement?"<document>":e===document.head?"<head>":e.labels?.length?Array.from(e.labels||[]).map(e=>e.innerText).join(" "):null}getFirstParentElement(e){let t=e;for(;t;){if(t instanceof HTMLElement)return t;t=t.parentElement}return null}getTargetType(e){let t="other";return"A"===e.nodeName?t="link":"BUTTON"===e.nodeName||e instanceof HTMLInputElement&&"button"===e.type?t="button":e instanceof HTMLInputElement&&("submit"===e.type?t="submit":"reset"===e.type?t="reset":"file"===e.type?t="file":"submit"!==e.type&&"reset"!==e.type&&"file"!==e.type&&(t="input")),t}hasAttribute(e,t){return t?.hasAttribute(e)||t?.hasAttribute(`data-${e}`)}clickableTarget(e){let t=e,n=!1;for(;t&&!n;){const e=this.getTargetType(t);n=Boolean("submit"===e||"button"===e||"link"===e||this.hasAttribute("pulse-clickable",t)),n||(t=t.parentElement)}return t}createInteractionElement(e){const t=this.getTargetType(e),n=Array.from(e.classList),r=this.getElementAttributes(e),i=e.getAttribute("pulse-name")||e.getAttribute("data-pulse-name")||e.getAttribute("pulse-clickable")||e.getAttribute("data-pulse-clickable")||e.name||e.getAttribute("name")||void 0;return{attributes:r,attributeValueByName:r.reduce((e,t)=>({...e,[t.name]:t.value}),{}),classList:n,nodeType:t,id:e.id,name:i,nodeName:e.nodeName,text:this.getElementText(e)||void 0}}createSection(e,t,n=void 0,r){const i=e?e.getAttribute("pulse-section")||e.getAttribute("data-pulse-section"):null,s=t?t.getAttribute("pulse-section-group")||t.getAttribute("data-pulse-section-group"):null,o=n?n.getAttribute("pulse-component")||n.getAttribute("data-pulse-component"):null,a=n?n.getAttribute("pulse-component-type")||n.getAttribute("data-pulse-component-type"):null;return{name:i||s||void 0,group:s||i||void 0,sectionElement:e&&this.createInteractionElement(e),sectionGroupElement:t&&this.createInteractionElement(t),popupComponent:o||void 0,popupComponentType:a||void 0,additionalProperties:r&&Object.keys(r).length>0?r:void 0}}collectDynamicAttributes(e){const t={};return Array.from(e.attributes).forEach(e=>{const n=e.name,r=e.value;if(n.startsWith("data-pulse-dynamic-")){const e=n.replace("data-pulse-dynamic-","");t[e]=r}else if(n.startsWith("pulse-dynamic-")){const e=n.replace("pulse-dynamic-","");t[e]=r}}),t}}const f=new e("Window"),m=new e("STORAGE_SELECTOR"),g=new e("COOKIE_BC"),y=new e("UN_PREFIXED_COOKIE_STORAGE"),v=new e("LOCK_MANAGER"),b=new e("PREFIXED_COOKIE_STORAGE");class w{}class S extends w{env;hrtTimeOrigin;constructor(e){super(),this.env=e;const t=this.now(),n=this.hrt(),r=e.win.performance.timeOrigin;this.hrtTimeOrigin=r??t-n}now(){return this.env.win.Date.now()}hrtTime(){return this.hrtTimeOrigin+this.env.win.performance.now()}hrt(){return this.env.win.performance.now()}timezoneOffset(){const e=new this.env.win.Date;return e.getTimezoneOffset&&e.getTimezoneOffset()}}var E,_,k;!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Verbose=4]="Verbose"}(E||(E={}));class T{storage;config;logLevel=E.Warn;KEY_LOG_LEVEL="log_level";constructor(e,t){this.storage=e,this.config=t}level(){return"number"!=typeof this.logLevel&&(this.logLevel=Number(this.storage.get(this.KEY_LOG_LEVEL)||0)||this.config.logLevel||0),this.logLevel}setLevel(e){this.logLevel=e,this.storage.set(this.KEY_LOG_LEVEL,String(e))}enabled(e){return e<=this.level()}error(e,...t){this.print(e,E.Error,t)}warn(e,...t){this.print(e,E.Warn,t)}info(e,...t){this.print(e,E.Info,t)}verbose(e,...t){this.print(e,E.Verbose,t)}print(e,t,n){if(this.enabled(t))switch(t){case E.Error:console.log(`${e}:`),console.error(...n);break;case E.Warn:console.warn(`${e}: `,...n);break;case E.Info:console.info(`${e}: `,...n);break;case E.Verbose:console.log(`${e}: `,...n)}}}function C(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||!e||!t)return!1;const n=e,r=t;return Object.keys({...n,...r}).every(e=>C(n[e],r[e]))}!function(e){e.All="all",e.External="external",e.Internal="internal"}(_||(_={})),function(e){e.Start="start",e.Full="full"}(k||(k={}));var N=function(e,t){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},N(e,t)};function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function P(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}c((r=r.apply(e,t||[])).next())})}function I(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function O(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function L(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function A(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function R(e){return this instanceof R?(this.v=e,this):new R(e)}function M(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function o(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=i[e](t)).value instanceof R?Promise.resolve(n.value.v).then(c,u):l(s[0][2],n)}catch(e){l(s[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function D(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=O(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}Object.create;"function"==typeof SuppressedError&&SuppressedError;function j(e){return"function"==typeof e}function V(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var U=V(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function B(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var H=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=O(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else s.remove(this);var c=this.initialTeardown;if(j(c))try{c()}catch(e){i=e instanceof U?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=O(u),h=l.next();!h.done;h=l.next()){var d=h.value;try{z(d)}catch(e){i=null!=i?i:[],e instanceof U?i=A(A([],L(i)),L(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(i)throw new U(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)z(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&B(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&B(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),$=H.EMPTY;function F(e){return e instanceof H||e&&"closed"in e&&j(e.remove)&&j(e.add)&&j(e.unsubscribe)}function z(e){j(e)?e():e.unsubscribe()}var q={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},K={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=K.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,A([e,t],L(n))):setTimeout.apply(void 0,A([e,t],L(n)))},clearTimeout:function(e){var t=K.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function W(e){K.setTimeout(function(){var t=q.onUnhandledError;if(!t)throw e;t(e)})}function G(){}var J=X("C",void 0,void 0);function X(e,t,n){return{kind:e,value:t,error:n}}var Y=null;function Z(e){if(q.useDeprecatedSynchronousErrorHandling){var t=!Y;if(t&&(Y={errorThrown:!1,error:null}),e(),t){var n=Y,r=n.errorThrown,i=n.error;if(Y=null,r)throw i}}else e()}var Q=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,F(t)&&t.add(n)):n.destination=oe,n}return x(t,e),t.create=function(e,t,n){return new re(e,t,n)},t.prototype.next=function(e){this.isStopped?se(function(e){return X("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?se(X("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?se(J,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(H),ee=Function.prototype.bind;function te(e,t){return ee.call(e,t)}var ne=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){ie(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){ie(e)}else ie(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){ie(e)}},e}(),re=function(e){function t(t,n,r){var i,s,o=e.call(this)||this;j(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&q.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},i={next:t.next&&te(t.next,s),error:t.error&&te(t.error,s),complete:t.complete&&te(t.complete,s)}):i=t;return o.destination=new ne(i),o}return x(t,e),t}(Q);function ie(e){var t;q.useDeprecatedSynchronousErrorHandling?(t=e,q.useDeprecatedSynchronousErrorHandling&&Y&&(Y.errorThrown=!0,Y.error=t)):W(e)}function se(e,t){var n=q.onStoppedNotification;n&&K.setTimeout(function(){return n(e,t)})}var oe={closed:!0,next:G,error:function(e){throw e},complete:G},ae="function"==typeof Symbol&&Symbol.observable||"@@observable";function ce(e){return e}function ue(e){return 0===e.length?ce:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var le=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,i=this,s=(r=e)&&r instanceof Q||function(e){return e&&j(e.next)&&j(e.error)&&j(e.complete)}(r)&&F(r)?e:new re(e,t,n);return Z(function(){var e=i,t=e.operator,n=e.source;s.add(t?t.call(s,n):n?i._subscribe(s):i._trySubscribe(s))}),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=he(t))(function(t,r){var i=new re({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ae]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ue(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=he(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function he(e){var t;return null!==(t=null!=e?e:q.Promise)&&void 0!==t?t:Promise}var de=V(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),pe=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return x(t,e),t.prototype.lift=function(e){var t=new fe(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new de},t.prototype.next=function(e){var t=this;Z(function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=O(t.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(e)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;Z(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Z(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?$:(this.currentObservers=null,s.push(e),new H(function(){t.currentObservers=null,B(s,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new le;return e.source=this,e},t.create=function(e,t){return new fe(e,t)},t}(le),fe=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return x(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:$},t}(pe),me={now:function(){return(me.delegate||Date).now()},delegate:void 0},ge=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=me);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return x(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,s=n._infiniteTimeWindow,o=n._timestampProvider,a=n._windowTime;r||(i.push(t),!s&&i.push(o.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,s=(i?1:2)*t;if(t<1/0&&s<r.length&&r.splice(0,r.length-s),!i){for(var o=n.now(),a=0,c=1;c<r.length&&r[c]<=o;c+=2)a=c;a&&r.splice(0,a+1)}},t}(pe);class ye{storage;storageKey;storageChangeOrigin;state;stateSubject$=new ge(1);constructor(e,t,n){this.storage=e,this.storageKey=t,this.storageChangeOrigin=n,this.registerStorageChangeListeners();const r=this.getState();this.stateSubject$.next(r)}setState(e){const t=this.getState(),n={...t,...e};C(t,n)||(this.state=n,this.storage.setJSON(this.storageKey,n),this.stateSubject$.next(n))}getState(){return this.state?this.state:this.refreshState()}getState$(){return this.stateSubject$.asObservable()}removePropertyFromState(e){const t=this.getState();if(e in t){const n={...t};delete n[e],C(t,n)||(this.state=n,this.storage.setJSON(this.storageKey,n),this.stateSubject$.next(n))}}refreshState(e){const t=e||this.storage.getJSON(this.storageKey)||this.state||{};return this.state=t,t}registerStorageChangeListeners(){this.storage.change(this.storageKey,k.Full,this.storageChangeOrigin).subscribe(({value:e})=>{const t=JSON.parse(e||"{}"),n=this.getState(),r=this.refreshState(t);C(n,r)||this.stateSubject$.next(r)})}}var ve=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function be(e){return j(null==e?void 0:e.then)}function we(e){return j(e[ae])}function Se(e){return Symbol.asyncIterator&&j(null==e?void 0:e[Symbol.asyncIterator])}function Ee(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var _e="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ke(e){return j(null==e?void 0:e[_e])}function Te(e){return M(this,arguments,function(){var t,n,r;return I(this,function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,R(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,R(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,R(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Ce(e){return j(null==e?void 0:e.getReader)}function Ne(e){if(e instanceof le)return e;if(null!=e){if(we(e))return i=e,new le(function(e){var t=i[ae]();if(j(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(ve(e))return r=e,new le(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()});if(be(e))return n=e,new le(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,W)});if(Se(e))return xe(e);if(ke(e))return t=e,new le(function(e){var n,r;try{for(var i=O(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()});if(Ce(e))return xe(Te(e))}var t,n,r,i;throw Ee(e)}function xe(e){return new le(function(t){(function(e,t){var n,r,i,s;return P(this,void 0,void 0,function(){var o,a;return I(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=D(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}function Pe(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Ie(e){return function(t){if(function(e){return j(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}function Oe(e,t,n,r,i){return new Le(e,t,n,r,i)}var Le=function(e){function t(t,n,r,i,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return x(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Q);function Ae(e,t){return void 0===t&&(t=0),Ie(function(n,r){n.subscribe(Oe(r,function(n){return Pe(r,e,function(){return r.next(n)},t)},function(){return Pe(r,e,function(){return r.complete()},t)},function(n){return Pe(r,e,function(){return r.error(n)},t)}))})}function Re(e,t){return void 0===t&&(t=0),Ie(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Me(e,t){if(!e)throw new Error("Iterable cannot be null");return new le(function(n){Pe(n,t,function(){var r=e[Symbol.asyncIterator]();Pe(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function De(e,t){if(null!=e){if(we(e))return function(e,t){return Ne(e).pipe(Re(t),Ae(t))}(e,t);if(ve(e))return function(e,t){return new le(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(be(e))return function(e,t){return Ne(e).pipe(Re(t),Ae(t))}(e,t);if(Se(e))return Me(e,t);if(ke(e))return function(e,t){return new le(function(n){var r;return Pe(n,t,function(){r=e[_e](),Pe(n,t,function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)},0,!0)}),function(){return j(null==r?void 0:r.return)&&r.return()}})}(e,t);if(Ce(e))return function(e,t){return Me(Te(e),t)}(e,t)}throw Ee(e)}function je(e,t){return t?De(e,t):Ne(e)}function Ve(e,t){return Ie(function(n,r){var i=0;n.subscribe(Oe(r,function(n){return e.call(t,n,i++)&&r.next(n)}))})}function Ue(e,t){return Ie(function(n,r){var i=0;n.subscribe(Oe(r,function(n){r.next(e.call(t,n,i++))}))})}function Be(e,t,n){return void 0===n&&(n=1/0),j(t)?Be(function(n,r){return Ue(function(e,i){return t(n,e,r,i)})(Ne(e(n,r)))},n):("number"==typeof t&&(n=t),Ie(function(t,r){return function(e,t,n,r,i,s,o,a){var c=[],u=0,l=0,h=!1,d=function(){!h||c.length||u||t.complete()},p=function(e){return u<r?f(e):c.push(e)},f=function(e){s&&t.next(e),u++;var a=!1;Ne(n(e,l++)).subscribe(Oe(t,function(e){null==i||i(e),s?p(e):t.next(e)},function(){a=!0},void 0,function(){if(a)try{u--;for(var e=function(){var e=c.shift();o?Pe(t,o,function(){return f(e)}):f(e)};c.length&&u<r;)e();d()}catch(e){t.error(e)}}))};return e.subscribe(Oe(t,p,function(){h=!0,d()})),function(){null==a||a()}}(t,r,e,n)}))}function He(e){return void 0===e&&(e=1/0),Be(ce,e)}var $e=new le(function(e){return e.complete()});function Fe(e){return e[e.length-1]}function ze(e){return(t=Fe(e))&&j(t.schedule)?e.pop():void 0;var t}function qe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ze(e),r=function(e,t){return"number"==typeof Fe(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?Ne(i[0]):He(r)(je(i,n)):$e}function Ke(e,t){return Ie(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Oe(r,function(n){null==i||i.unsubscribe();var o=0,c=s++;Ne(e(n,c)).subscribe(i=Oe(r,function(e){return r.next(t?t(n,e,c,o++):e)},function(){i=null,a()}))},function(){o=!0,a()}))})}var We=V(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Ge(){return new We}function Je(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Ve(function(t,n){return e(t,n,r)}):ce,(s=1)<=0?function(){return $e}:Ie(function(e,t){var n=0;e.subscribe(Oe(t,function(e){++n<=s&&(t.next(e),s<=n&&t.complete())}))}),n?function(e){return Ie(function(t,n){var r=!1;t.subscribe(Oe(n,function(e){r=!0,n.next(e)},function(){r||n.next(e),n.complete()}))})}(t):(void 0===(i=function(){return new We})&&(i=Ge),Ie(function(e,t){var n=!1;e.subscribe(Oe(t,function(e){n=!0,t.next(e)},function(){return n?t.complete():t.error(i())}))})));var i,s}}function Xe(e,t){const n="string"==typeof t?t:t?.entryType,r=e.entry_type===n,i=function(e,t){if("string"==typeof t)return!0;if(void 0===t.name)return!0;if(Array.isArray(t.name))return t.name.some(t=>t instanceof RegExp?t.test(e):t===e);return!1}(e.name,t),s="object"!=typeof t||"function"!=typeof t.filter||t.filter(e);return r&&i&&s}class Ye{timeline;resource;constructor(e,t){this.timeline=e,this.resource=t}subscribe(e,t){const n=[...e,...t||[]],r=n.some(e=>"resource"===e||"object"==typeof e&&"resource"===e.entryType),i=qe(r?this.resource.subscribe(n):je([]),this.timeline.subscribe(n).pipe(Ve(e=>"resource"!==e.entry_type))),s=i.pipe(Ve(e=>!t||t.every(t=>!Xe(e,t))));return qe(je(t||[]).pipe(Ke(e=>i.pipe(Ve(t=>Xe(t,e)),Je()))),s).pipe(Ue(e=>this.enrichWithServerAttributes(e)))}enrichWithServerAttributes(e){if(Array.isArray(e.server_timing)){const t=[...e.server_timing],n={};for(const r of e.server_timing){const e=/^pulse\$([^$]+)\$([^$]+)$/.exec(r.name);if(!e?.length)continue;const i=(e[1]||"").toLowerCase(),s=(e[2]||"").toLowerCase();n[i]=s,t.splice(t.indexOf(r),1)}e.server_timing=t,e.server_attributes=n}return e}}function Ze(e,t,n){var r=j(e)||t||n?{next:e,error:t,complete:n}:e;return r?Ie(function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(Oe(t,function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)},function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()},function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)},function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)}))}):ce}class Qe{env;cssPathService;date;firstPageHide;constructor(e,t,n,r){this.env=e,this.cssPathService=t,this.date=n,r.visible||(this.firstPageHide=n.hrtTimeOrigin),r.onVisibilityChange().pipe(Ve(e=>!e),Je()).subscribe(()=>{this.firstPageHide=n.hrt()})}subscribe(e,t=!0){return qe(...e.filter(e=>this.entrySupported(e)).map(e=>this.getFilterStream(e,t)))}getEntries(e){return qe(...e.filter(e=>this.entrySupported(e)).map(e=>this.getFilterStream(e,!1,!0)))}getFilterStream(e,t,n){const r=this.env.win;return r.performance.getEntries&&r.performance.getEntriesByType&&r.performance.timeOrigin?n?this.readEntries(e):"function"==typeof r.PerformanceObserver&&r.WeakSet?this.getFilterStreamNative(e,t):this.getFilterStreamLegacy(e,t):je([])}readEntries(e){const t="string"==typeof e?e:e.entryType,n=new WeakSet;return je(this.env.win.performance.getEntriesByType(t)).pipe(Ve(e=>!n.has(e)),Ze(e=>n.add(e)),Ue(e=>this.mapEntry(e)),Ve(t=>Xe(t,e)))}getFilterStreamNative(e,t){return new le(n=>{const r=new WeakSet,i=new this.env.win.PerformanceObserver(t=>{const i=t.getEntries();for(const t of i){if(r.has(t))continue;r.add(t);const i=this.mapEntry(t);Xe(i,e)&&n.next(i)}}),s="string"==typeof e?e:e?.entryType;return i.observe({type:s,buffered:t}),()=>i.disconnect()})}getFilterStreamLegacy(e,t){return new le(n=>{const r=this.env.win.performance,i="string"==typeof e?e:e?.entryType;let s=t?0:r.now();const o=setInterval(()=>{const t=this.env.win.performance.getEntriesByType(i);let r=s;for(const i of t){const t=this.mapEntry(i);r<i.startTime&&(r=i.startTime),i.startTime<s||Xe(t,e)&&n.next(t)}s=r},1e3);return()=>clearInterval(o)})}mapEntry(e){const t=this.env.win.navigator.connection,n="xmlhttprequest"===(String(e.initiatorType)+"").toLowerCase()?"xhr":String(e.initiatorType);let r={time_origin:this.date.hrtTimeOrigin,details:e.detail,name:e.name,entry_type:e.entryType,type:e.type,protocol:e.nextHopProtocol||void 0,task_duration:e.duration,start_time:e.startTime,end_time:e.responseEnd??(e.duration?e.startTime+e.duration:void 0),initiator_type:n,worker_start:e.workerStart,redirect_start:e.redirectStart,redirect_end:e.redirectEnd,fetch_start:e.fetchStart,domain_lookup_start:e.domainLookupStart,domain_lookup_end:e.domainLookupEnd,connect_start:e.connectStart,connect_end:e.connectEnd,secure_connection_start:e.secureConnectionStart,request_start:e.requestStart,response_start:e.responseStart,response_end:e.responseEnd,transfer_size:e.transferSize,encoded_body_size:e.encodedBodySize,decoded_body_size:e.decodedBodySize,unload_event_start:e.unloadEventStart,unload_event_end:e.unloadEventEnd,dom_interactive:e.domInteractive,dom_content_loaded_event_start:e.domContentLoadedEventStart,dom_content_loaded_event_end:e.domContentLoadedEventEnd,dom_complete:e.domComplete,load_event_start:e.loadEventStart,load_event_end:e.loadEventEnd,redirect_count:e.redirectCount,processing_start:e.processingStart,processing_end:e.processingEnd,cancelable:e.cancelable,render_blocking:e.renderBlockingStatus?"blocking"===e.renderBlockingStatus:void 0,had_recent_input:e.hadRecentInput,last_input_time:e.lastInputTime,cls_value:e.value,before_page_hide:this.beforePageHide(e.startTime)};return Array.isArray(e.serverTiming)&&e.serverTiming.length&&(r.server_timing=e.serverTiming),Array.isArray(e.workerTiming)&&e.workerTiming.length&&(r.worker_timing=e.workerTiming),!t||"resource"!==r.entry_type&&"navigation"!==r.entry_type||(r={...r,connection_downlink:t.downlink,connection_rtt:t.rtt,connection_type:t.effectiveType,data_saving_mode:t.saveData}),Array.isArray(e.attribution)&&(r.attribution=e.attribution.map(e=>({name:e?.name,entry_type:e?.entryType,start_time:e?.startTime,duration:e?.duration,container_type:e?.containerType,container_src:e?.containerSrc,container_id:e?.containerId,container_name:e?.containerName}))),"layout-shift"===r.entry_type&&Array.isArray(e.sources)&&(r.cls_sources=e.sources.map(e=>this.createCLSAttribution(e)).filter(Boolean)),r}beforePageHide(e){return!this.firstPageHide||(e?e<this.firstPageHide:void 0)}entrySupported(e){const t=this.env.win.PerformanceObserver?.supportedEntryTypes||[],n="string"==typeof e?e:e.entryType;return t.indexOf(n)>-1}createCLSAttribution(e){if("object"!=typeof e||"object"!=typeof e.node)return null;const t=e.node,n={current_rect:e.currentRect,previous_rect:e.previousRect};if(t){const e=this.cssPathService.cssPath(t);n.node={path:e}}return n}}class et{fetchCollector;xhrCollector;timeline;date;env;performanceTimeline;constructor(e,t,n,r,i){this.fetchCollector=e,this.xhrCollector=t,this.timeline=n,this.date=r,this.env=i;const s=new ge(1e3);this.performanceTimeline=s,this.timeline.subscribe(["resource"]).subscribe(s)}subscribe(e){const t=this.date.hrt(),n=qe(this.fetchCollector.requests(),this.xhrCollector.requests()).pipe(Ke(e=>this.findEntry(e)));return qe(this.performanceTimeline.pipe(Ve(e=>"fetch"!==e.initiator_type&&"xhr"!==e.initiator_type||e.start_time<=t),Ue(e=>({entry:e}))),n).pipe(Ue(e=>this.mergeRequestEntry(e)),Ve(Boolean),Ve(t=>!e||e.some(e=>Xe(t,e))))}mergeRequestEntry(e){const t=e.request,n=Boolean(t)&&void 0!==t&&("basic"===t.responseMode||"cors"===t.responseMode||"default"===t.responseMode);let r=e.entry;if(r)r.response_entry_matched=Boolean(t);else{if(!t)return null;const e=this.env.win.navigator.connection;r={name:t.url,entry_type:"resource",initiator_type:t.initiator,start_time:t.start,end_time:t.end,task_duration:(t.fetchEnd||t.end)-t.start,time_origin:this.date.hrtTimeOrigin,response_entry_matched:!1},n&&(r.decoded_body_size=t.responseBodySize,r.transfer_size=t.responseBodySize),e&&(r={...r,connection_downlink:e.downlink,connection_rtt:e.rtt,connection_type:e.effectiveType,data_saving_mode:e.saveData})}return t&&this.enrichWithRequest(r,t,n),r}enrichWithRequest(e,t,n){e.request_method=t.method,e.response_status=t.responseStatus,e.response_mode=t.responseMode,e.request_body_size=t.requestBodySize,e.response_end=e.response_end||t.fetchEnd||t.end,e.end_time=t.end,e.user_duration=t.end-t.start,e.response_content_type=t.responseContentType,e.request_content_type=t.requestContentType,e.redirected=t.redirected,e.aborted=t.aborted,n&&(e.transfer_size=e.transfer_size||t.responseBodySize,e.response_body_size=t.responseBodySize,e.decoded_body_size=t.responseBodySize,e.transfer_size=t.responseBodySize)}findEntry(e){return this.performanceTimeline.pipe(Ve(e=>"fetch"===e.initiator_type||"xhr"===e.initiator_type),Ve(t=>this.matchLax(e,t)),Je(),Ue(t=>({entry:t,request:e})))}matchLax(e,t){const n=t.start_time,r=t.task_duration?t.start_time+t.task_duration:t.response_end||0;return n>=e.start-1&&r<=e.end+1&&e.url===t.name}}class tt{plugins=[];init(e){this.plugins.forEach(t=>t.init&&t.init(e))}enqueue(e,t){return this.plugins.every(n=>!n.enqueue||n.enqueue(e,t))}beforeBatchSend(e,t){return this.plugins.reduce((e,n)=>e&&n.beforeBatchSend?n.beforeBatchSend(e,t):e,e)}batchSent(e,t){this.plugins.forEach(n=>n.batchSent&&n.batchSent(e,t))}sessionChange(){throw new Error("Method not implemented.")}stateChange(){throw new Error("Method not implemented.")}register(e){this.plugins.push(e)}}const nt=new e("INTERNAL_DATA_LAYER"),rt=new e("DATA_LAYER"),it=new e("DEFAULT_PIPES_HOST_TOKEN"),st=new e("PIPES_HOST_TOKEN");class ot{}class at extends ot{transformPipes=[];enrichmentPipes=[];process(e,t){return this.transform(e,t).map(e=>this.enrich(e,t))}transform(e,t){const n=this.selectPipeSet(e,this.transformPipes);let r=[e];for(const e of n){if(!e.transform)continue;const n=[];for(const i of r){const r=e.transform(i,t);n.push(...r)}r=n}return r}enrich(e,t){return this.selectPipeSet(e,this.enrichmentPipes).reverse().reduce((e,n)=>n.enrich(e,t),e)}registerTransformSet(e){this.transformPipes.push(e)}registerEnrichmentSet(e){this.enrichmentPipes.push(e)}selectPipeSet(e,t){for(const n of t){if(!("*"===n.selector||n.selector===e.type||"function"==typeof n.selector&&n.selector(e)||!1))continue;if(!("function"==typeof n.exclude&&n.exclude(e)))return[...n.use]}return[]}}class ct{}class ut extends ct{}class lt extends ut{}class ht extends lt{}class dt{dataLayer;commandPrefix;defaultPush;tracker;constructor(e,t){this.dataLayer=e,this.commandPrefix=t}init(e){if(this.tracker=e.tracker,!Array.isArray(this.dataLayer))throw new Error("DataLayer must be an array!");this.defaultPush=this.dataLayer.push.bind(this.dataLayer),this.dataLayer.push=this.onPush.bind(this),this.readFromBeginning()}onPush(...e){for(const t of e)this.processItem(t);return this.defaultPush?this.defaultPush(...e):0}readFromBeginning(){for(const e of this.dataLayer)this.processItem(e)}processItem(e){if(!this.tracker||"object"!=typeof e||!e)return;const t=e;if(this.isCommand(e)){const t=Array.from(e);this.tracker.cmd(t)}else if("event"===e.pulse){const t=this.normalize(e);this.tracker.event(t)}else if("state"===e.pulse){const t=this.normalize(e);this.tracker.set(t)}else"custom_event"!==t.event&&"custom_event_non_interaction"!==t.event||this.tracker.event(t.data)}isCommand(e){return(Array.isArray(e)||"[object Arguments]"===Object.prototype.toString.call(e))&&"string"==typeof e[0]&&e[0].startsWith(this.commandPrefix)}normalize(e){const t={...e};return delete t.paa,t.pulse&&delete t.pulse,t}}class pt{navigationEventPlugin;visibilityChangePlugin;clickEventPlugin;config;popupEventPlugin;internalDataLayer;rumPlugin;contextmenuPlugin;pluginHost;dataLayer;constructor(e,t,n,r,i,s,o,a,c,u){this.navigationEventPlugin=e,this.visibilityChangePlugin=t,this.clickEventPlugin=n,this.config=r,this.popupEventPlugin=i,this.internalDataLayer=s,this.rumPlugin=o,this.contextmenuPlugin=a,this.pluginHost=c,this.dataLayer=u}registerPlugins(){const e=[this.visibilityChangePlugin,this.clickEventPlugin,this.navigationEventPlugin,this.popupEventPlugin,this.rumPlugin,this.contextmenuPlugin,...this.config.plugins||[]];this.dataLayer&&e.push(new dt(this.dataLayer,"paa.")),this.internalDataLayer&&Array.isArray(this.internalDataLayer)&&e.push(new dt(this.internalDataLayer,"")),e.forEach(e=>this.pluginHost.register(e))}}class ft{actionParamEventPipe;eventGlobalsPipe;pipesHost;defaultPipesHost;config;constructor(e,t,n,r,i){this.actionParamEventPipe=e,this.eventGlobalsPipe=t,this.pipesHost=n,this.defaultPipesHost=r,this.config=i}registerPipes(){const e=this.config.transformPipes||[],t=this.config.enrichmentPipes||[],n=[{selector:"event",use:[this.actionParamEventPipe]}],r=[{selector:"event",use:[this.eventGlobalsPipe]}];n.forEach(e=>this.defaultPipesHost.registerTransformSet(e)),r.forEach(e=>this.defaultPipesHost.registerEnrichmentSet(e)),e.forEach(e=>this.pipesHost.registerTransformSet(e)),t.forEach(e=>this.pipesHost.registerEnrichmentSet(e))}}class mt{win;doc;landingUrl;navigator;constructor(e){this.win=e,this.doc=this.win.document,this.landingUrl=this.getInitialDocumentURL(),this.navigator=this.win.navigator}getInitialDocumentURL(){if("function"==typeof this.win.performance?.getEntries){const e=this.win.performance.getEntries().find(e=>"navigation"===e.entryType);if(e&&this.isValidURL(e.name))return e.name}return this.isValidURL(this.win.pulse?.idu)?this.win.pulse.idu:this.win.document.location.href}isValidURL(e){if("string"!=typeof e)return!1;try{const t=new URL(e);return Boolean(t.hostname)}catch{return!1}}}class gt{enrich(e){const t=e.data;return"object"==typeof t.data&&null!==t.data||(t.data={}),t.data={...t.data},t.timestamp=e.timestamp,t.data.metadata={event_id_source:"mini_sdk"},e.data=t,e}}class yt{transform(e){const t={...e.data};return"string"==typeof t.event&&t.event||"string"!=typeof t.action||!t.action||(t.event=t.action,delete t.action),"object"==typeof t.data&&t.data||("object"==typeof t.parameters&&t.parameters?(t.data=t.parameters,delete t.parameters):t.data={}),e.data=t,[e]}}class vt{historyTracker;navigationService;activitySynchronizer;initial=!0;lastRoutePath="";constructor(e,t,n){this.historyTracker=e,this.navigationService=t,this.activitySynchronizer=n}init(){this.activitySynchronizer.startService(),this.historyTracker.navigation.subscribe(e=>{this.lastRoutePath!==e&&(this.lastRoutePath=e,this.navigationService.send(this.initial,e),this.initial=!1)})}}var bt;!function(e){e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden"}(bt||(bt={}));class wt{visibility;visibilityState=bt.Visible;constructor(e){this.visibility=e}init(){this.visibility.onVisibilityChange().subscribe(e=>{this.visibilityState=e?bt.Visible:bt.Hidden})}}class St{activity;env;constructor(e,t){this.activity=e,this.env=t}init(){this.activity.interactions().pipe(Ve(e=>"click"===e.type&&!e.doNotTrack&&e.clickable)).subscribe(e=>{this.env.win.dataLayer?.push({pulse:"event",event:"click",data:{click_source:{section:e.section.name,group:e.section.group,popup_component:e.section.popupComponent,popup_component_type:e.section.popupComponentType,element:{id:e.element?.id||e.element?.name,name:e.element?.name,node_type:e.element?.nodeName,class_list:e.element?.classList}},additionalProperties:e?.additionalProperties}})})}}class Et{activityTracker;env;constructor(e,t){this.activityTracker=e,this.env=t}init(){this.activityTracker.mutations().pipe(Be(e=>e.mutatedElements)).subscribe(e=>{e&&this.env.win.dataLayer?.push({pulse:"event",event:"popup",data:{component:e.component,component_type:e.componentType,popup_source:{section:e.section.name,group:e.section.group},action:"addedNodes"===e.mutationType?"open":"close",click_source:{url:this.activityTracker.lastClickSourceInformation?.url,section:this.activityTracker.lastClickSourceInformation?.name,group:this.activityTracker.lastClickSourceInformation?.group,popup_component:this.activityTracker.lastClickSourceInformation?.popupComponent,popup_component_type:this.activityTracker.lastClickSourceInformation?.popupComponentType,element:{id:this.activityTracker.lastClickSourceInformation?.element?.id||this.activityTracker.lastClickSourceInformation?.element?.name,name:this.activityTracker.lastClickSourceInformation?.element?.name,node_type:this.activityTracker.lastClickSourceInformation?.element?.nodeName,class_list:this.activityTracker.lastClickSourceInformation?.element?.classList}},additionalProperties:e?.additionalProperties}})})}}class _t{rum;env;constructor(e,t){this.rum=e,this.env=t}init(e){this.rum.subscribe(e.config.rumReport,e.config.rumReportOnce).subscribe(e=>{this.env.win.dataLayer?.push({pulse:"event",event:"rum",data:e})})}}class kt{activity;env;constructor(e,t){this.activity=e,this.env=t}init(){this.activity.interactions().pipe(Ve(e=>"contextmenu"===e.type&&"link"===e.element?.nodeType&&!e.doNotTrack&&e.clickable)).subscribe(e=>{this.env.win.dataLayer?.push({pulse:"event",event:"contextmenu",data:{click_source:{section:e.section.name,group:e.section.group,popup_component:e.section.popupComponent,popup_component_type:e.section.popupComponentType,element:{id:e.element?.id||e.element?.name,name:e.element?.name,node_type:e.element?.nodeName,class_list:e.element?.classList}},additionalProperties:e?.additionalProperties}})})}}class Tt{env;constructor(e){this.env=e}send(e){e.forEach(e=>{if(this.env.win.pulse?._transport)return this.env.win.pulse?._transport({eventName:e.data.event,params:e.data.data})})}}var Ct=Array.isArray;function Nt(e){return Ue(function(t){return function(e,t){return Ct(t)?e.apply(void 0,A([],L(t))):e(t)}(e,t)})}var xt=["addListener","removeListener"],Pt=["addEventListener","removeEventListener"],It=["on","off"];function Ot(e,t,n,r){if(j(n)&&(r=n,n=void 0),r)return Ot(e,t,n).pipe(Nt(r));var i=L(function(e){return j(e.addEventListener)&&j(e.removeEventListener)}(e)?Pt.map(function(r){return function(i){return e[r](t,i,n)}}):function(e){return j(e.addListener)&&j(e.removeListener)}(e)?xt.map(Lt(e,t)):function(e){return j(e.on)&&j(e.off)}(e)?It.map(Lt(e,t)):[],2),s=i[0],o=i[1];if(!s&&ve(e))return Be(function(e){return Ot(e,t,n)})(Ne(e));if(!s)throw new TypeError("Invalid event target");return new le(function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return s(t),function(){return o(t)}})}function Lt(e,t){return function(n){return function(r){return e[n](t,r)}}}const At=["click","contextmenu"],Rt=[...At];class Mt{visibilityTracker;win;activityTrackerUtils;interactionEventsSubject=new ge;mutationEventsSubject=new ge;mutationObserver;lastClickSourceInformation;static MUTATION_OBSERVER_CONFIG={childList:!0,subtree:!0};static EVENT_LISTENER_OPTIONS={capture:!0,passive:!0};static COMPONENT_SELECTORS={component:"[pulse-component], [data-pulse-component]",section:"[pulse-section], [data-pulse-section]",sectionGroup:"[pulse-section-group], [data-pulse-section-group]",doNotTrack:"[pulse-dnt]"};constructor(e,t,n){this.visibilityTracker=e,this.win=t,this.activityTrackerUtils=n,this.initializeTracking()}interactions(){return this.interactionEventsSubject.asObservable()}mutations(){return this.mutationEventsSubject.asObservable()}initializeTracking(){const e=this.createInteractionEventsStream(),t=this.createMutationEventsStream();e.subscribe(this.interactionEventsSubject),t.subscribe(this.mutationEventsSubject)}createMutationEventsStream(){const e=new ge;return this.mutationObserver=new MutationObserver(t=>{const n=this.processMutations(t);n.length>0&&e.next({mutatedElements:n})}),this.mutationObserver.observe(document,Mt.MUTATION_OBSERVER_CONFIG),e.asObservable()}processMutations(e){return[...this.extractMutatedElements(e,"addedNodes"),...this.extractMutatedElements(e,"removedNodes")].map(e=>this.processMutatedElement(e)).filter(e=>null!==e)}extractMutatedElements(e,t){return e.flatMap(e=>Array.from(e[t]).map(n=>({node:n,target:e.target,mutationType:t}))).filter(({node:e})=>e instanceof HTMLElement)}processMutatedElement(e){const t=this.getInteractionInfoFor(e.node,e.target);if(!t)return null;const n=this.findComponentElement(t.element);if(!n)return null;const r=this.extractComponentInfo(n);if(!r.component)return null;if("addedNodes"===e.mutationType&&this.isElementHidden(t.element))return null;const i=this.shouldCollectDynamicAttributes(r)?this.collectElementDynamicAttributes(n):void 0;return{element:this.activityTrackerUtils.createInteractionElement(n),component:r.component,componentType:r.componentType||r.component,mutationType:e.mutationType,section:this.activityTrackerUtils.createSection(t.section,t.sectionGroup,void 0,i),additionalProperties:i}}findComponentElement(e){if(this.hasComponentAttribute(e))return e;return e.querySelector(Mt.COMPONENT_SELECTORS.component)}hasComponentAttribute(e){return Boolean(this.activityTrackerUtils.hasAttribute("pulse-component",e))}extractComponentInfo(e){const t=this.activityTrackerUtils.createInteractionElement(e);return{component:t.attributeValueByName["pulse-component"]||t.attributeValueByName["data-pulse-component"],componentType:t.attributeValueByName["pulse-component-type"]||t.attributeValueByName["data-pulse-component-type"]}}shouldCollectDynamicAttributes(e){return Boolean(e.component&&e.componentType)}collectElementDynamicAttributes(e){const t={};return Array.from(e.attributes).forEach(e=>{const n=this.extractDynamicAttributeKey(e.name);n&&e.value&&(t[n]=e.value)}),Object.keys(t).length>0?t:void 0}extractDynamicAttributeKey(e){return e.startsWith("data-pulse-dynamic-")?e.replace("data-pulse-dynamic-",""):e.startsWith("pulse-dynamic-")?e.replace("pulse-dynamic-",""):null}isElementHidden(e){const t=this.win.win.getComputedStyle(e);return"none"===t.display||"hidden"===t.visibility||void 0===t.display}createInteractionEventsStream(){const e=this.win.doc.body;return je(Rt).pipe(Ue(t=>Ot(e,t,Mt.EVENT_LISTENER_OPTIONS)),He(),Ue(e=>this.processWindowEvent(e)),Ve(e=>null!==e),Ze(e=>this.updateLastClickSourceInformation(e)))}updateLastClickSourceInformation(e){this.isTrackableClickEvent(e)&&(this.lastClickSourceInformation={name:e.section.name,group:e.section.group,popupComponent:e.section.popupComponent,popupComponentType:e.section.popupComponentType,element:e.element,url:e.docURL,additionalProperties:e.additionalProperties})}isTrackableClickEvent(e){return("click"===e.type||"contextmenu"===e.type)&&!e.doNotTrack&&Boolean(e.clickable)}processWindowEvent(e){if(!e.target)return null;const t=this.getInteractionInfoFor(e.target);if(!t)return null;const n=this.collectEventDynamicAttributes(e,t),r=this.win.doc;return{type:e.type,trusted:e.isTrusted??!0,eventPhase:e.eventPhase,bubbles:e.bubbles,section:this.activityTrackerUtils.createSection(t.section,t.sectionGroup,t.popupComponent,n),element:this.activityTrackerUtils.createInteractionElement(t.element),docFocused:r.hasFocus(),docVisible:this.visibilityTracker.visible,docURL:r.location.href,doNotTrack:t.doNotTrack,clickable:t.clickable,ts:Date.now(),additionalProperties:Object.keys(n).length>0?n:void 0}}collectEventDynamicAttributes(e,t){if("click"!==e.type&&"contextmenu"!==e.type)return{};let n=this.activityTrackerUtils.collectDynamicAttributes(t.element);if(t.popupComponent&&this.shouldCollectPopupAttributes(t.popupComponent)){const e=this.activityTrackerUtils.collectDynamicAttributes(t.popupComponent);n={...n,...e}}return n}shouldCollectPopupAttributes(e){const t=Boolean(this.activityTrackerUtils.hasAttribute("pulse-component",e)||this.activityTrackerUtils.hasAttribute("data-pulse-component",e)),n=Boolean(this.activityTrackerUtils.hasAttribute("pulse-component-type",e)||this.activityTrackerUtils.hasAttribute("data-pulse-component-type",e));return t&&n}getInteractionInfoFor(e,t){const n=this.win.doc,r=this.normalizeInteractionNode(e,n),i=this.activityTrackerUtils.getFirstParentElement(r);if(!i)return;const s=this.activityTrackerUtils.getTargetType(r),o=this.findRelevantElements(i,t),a=this.activityTrackerUtils.clickableTarget(i),c=a||i,u=this.checkDoNotTrack(c);return{clickable:Boolean(a),doNotTrack:u,type:s,element:c,section:o.sectionElement,sectionGroup:o.sectionGroup,popupComponent:o.popupComponent}}normalizeInteractionNode(e,t){return e instanceof Node&&e!==t&&e!==t.head?e:t.documentElement}findRelevantElements(e,t){const n=t instanceof Element?t:null;return{sectionElement:this.findClosestElement(n,e,"section"),sectionGroup:this.findClosestElement(n,e,"sectionGroup"),popupComponent:this.findClosestElement(n,e,"component")}}findClosestElement(e,t,n){const r={section:Mt.COMPONENT_SELECTORS.section,sectionGroup:Mt.COMPONENT_SELECTORS.sectionGroup,component:Mt.COMPONENT_SELECTORS.component}[n];return e?.closest(r)||t.closest(r)||void 0}checkDoNotTrack(e){return Boolean(e.closest(Mt.COMPONENT_SELECTORS.doNotTrack))}}function Dt(e,t){return void 0===t&&(t=ce),e=null!=e?e:jt,Ie(function(n,r){var i,s=!0;n.subscribe(Oe(r,function(n){var o=t(n);!s&&e(i,o)||(s=!1,i=o,r.next(n))}))})}function jt(e,t){return e===t}const Vt={capture:!0,passive:!0};class Ut{env;get visible(){return this.isPageVisible()}hiddenPropName="hidden";visibilityStatePropName="visibilityState";visibilityEventName="visibilitychange";constructor(e){this.env=e,this.configureVisibilityListener()}onVisibilityChange(){const e=this.env.win.document;let t=new pe;return this.configureVisibilityListener()&&(t=Ot(e,this.visibilityEventName).pipe(Ue(()=>this.isPageVisible()))),this.fullVisibilityAPISupport()||(t=qe(t,this.legacyVisibilityEvents())),t.pipe(Dt())}legacyOnUnload(){const e=this.env.win;return qe(this.legacyPageHide(),Ot(e,"beforeunload",Vt),Ot(e,"unload",Vt))}legacyPageHide(){return Ot(this.env.win,"pagehide",Vt)}legacyVisibilityEvents(){return qe(this.legacyOnUnload().pipe(Ue(()=>!1)),Ot(this.env.win,"pageshow",Vt).pipe(Ue(()=>!0)),Ot(this.env.win,"focus",Vt).pipe(Ue(()=>!0))).pipe(Dt())}isPageVisible(){const e=this.env.doc;return"string"==typeof e[this.visibilityStatePropName]&&e[this.visibilityStatePropName]?"visible"===e[this.visibilityStatePropName]:"boolean"==typeof e[this.hiddenPropName]?!e[this.hiddenPropName]:!this.env.win.document.hasFocus||this.env.win.document.hasFocus()}configureVisibilityListener(){const e=["","ms","webkit","moz","o"],t=this.env.doc;for(const n of e){const e=n?`${n}Hidden`:"hidden",r=n?`${n}VisibilityState`:"visibilityState",i=(n||"")+"visibilitychange";if(e in t||r in t)return this.hiddenPropName=e,this.visibilityEventName=i,this.visibilityStatePropName=r,!0}return!1}fullVisibilityAPISupport(){const e=this.env.doc,t=this.env.win.navigator.userAgent;return"string"==typeof e.visibilityState&&"boolean"==typeof e.hidden&&void 0!==e.onvisibilitychange&&!/Safari/i.test(t)}}class Bt{env;navigation=new pe;constructor(e){this.env=e,this.init()}init(){this.env.win.pulse?._route?.subscribe(e=>{this.navigation.next(e.route)})}}class Ht{persistentStorage;activityTracker;date;config;pageEvents=[];constructor(e,t,n,r){this.persistentStorage=e,this.activityTracker=t,this.date=n,this.config=r}startService(){this.activityTracker.interactions().pipe(Ve(e=>"click"===e.type&&!e.doNotTrack&&e.clickable)).subscribe(e=>{const t=this.date.now();this.pageEvents.push(e),this.pageEvents=this.pageEvents.slice(this.pageEvents.length-100).filter(e=>t-e.ts<=this.config.detectionTimeWindow),this.pageEvents.length?this.persistentStorage.setJSON("activity",this.pageEvents):this.remove()})}getEvents(){return this.persistentStorage.getJSON("activity")}remove(){this.persistentStorage.remove("activity")}}var $t;!function(e){e[e.LinkInteraction=1]="LinkInteraction",e[e.Link=2]="Link",e[e.Interaction=3]="Interaction",e[e.Focus=4]="Focus",e[e.Visibility=5]="Visibility",e[e.NoVisibility=6]="NoVisibility"}($t||($t={}));class Ft{storage;activitySyncService;date;env;config;firstNavigationKey="first_navigation";firstNavigation=!0;constructor(e,t,n,r,i){this.storage=e,this.activitySyncService=t,this.date=n,this.env=r,this.config=i}isFirstNavigation(){return this.firstNavigation}getTriggerEvent(e=!1){const t=this.storage.getJSON(this.firstNavigationKey),n=void 0===t?.firstNavigation,r=t?.lastNavigationCount||0;this.storage.setJSON(this.firstNavigationKey,{firstNavigation:!1,lastNavigationCount:this.env.win.history.length,lastNavigationUrl:this.env.win.location.href}),this.firstNavigation=n;const i=this.env.win.history.length-r>1&&!n,s=i?5e3:e?3500:500,o=$t.NoVisibility,a=t?.lastNavigationUrl||this.env.win.document.referrer,c=this.activitySyncService.getEvents()||[],u=this.detectTriggerEvent(a,c,s,o,i);return u?{type:u?.type,url:u?.eventUrl,name:u?.section.name,group:u?.section.group,element:u?.element}:null}detectTriggerEvent(e,t,n,r,i){const s=this.ctreateTriggerEvents(e,t).filter(e=>e.timeDiff<=n);if(!s.length)return null;for(let t=1;t<=r;t++){const n=this.filterAccuracyMatches(s,e,t,i);if(n.length&&t<$t.NoVisibility)return n[0]||null}return null}filterAccuracyMatches(e,t,n,r){switch(n){case $t.LinkInteraction:return this.filterLinkInteractionEvents(e,t);case $t.Link:return this.filterLinkEvents(e,t);case $t.Interaction:return this.filterInteractionEvents(e,t);case $t.Focus:return this.filterFocusedEvents(e,t,r);case $t.Visibility:return this.filterVisibleEvents(e,t);case $t.NoVisibility:default:return this.filterNoVisibility(e,t)}}filterLinkInteractionEvents(e,t){return e.filter(e=>(!t||e.docURL.startsWith(t))&&this.isLinkMatch(e)&&this.isInteractionEvent(e)&&e.docFocused&&e.docVisible)}filterLinkEvents(e,t){return e.filter(e=>(!t||e.docURL.startsWith(t))&&this.isLinkMatch(e)&&e.docFocused&&e.docVisible)}filterInteractionEvents(e,t){return e.filter(e=>(!t||e.docURL.startsWith(t))&&this.isInteractionEvent(e)&&e.docFocused&&e.docVisible)}filterFocusedEvents(e,t,n){return e.filter(e=>n?e.docFocused&&e.docVisible:(!t||e.docURL.startsWith(t))&&e.docFocused&&e.docVisible)}filterVisibleEvents(e,t){return e.filter(e=>(!t||e.docURL.startsWith(t))&&e.docVisible)}filterNoVisibility(e,t){return e.filter(e=>!t||e.docURL.startsWith(t))}isLinkMatch(e){if(e.element&&"A"===e.element.nodeName){const t=e.element.attributes.find(e=>"href"===e.name)?.value;return t===this.config.initialDocURL}return!1}isInteractionEvent(e){return-1!==At.indexOf(e.type)}ctreateTriggerEvents(e,t){const n=this.date.now()-2;let r=[];return r=t.map(t=>({...t,timeDiff:Math.abs(n-t.ts),referrerMatch:!e||t.docURL.startsWith(e),eventUrl:t.docURL})),r.sort((e,t)=>e.timeDiff>t.timeDiff?1:e.timeDiff<t.timeDiff?-1:0)}}class zt{env;inititatorDetector;constructor(e,t){this.env=e,this.inititatorDetector=t}send(e,t){const n={event:"navigation",pulse:"event",data:{initial:e,url:t,click_source:{}}},r=this.inititatorDetector.getTriggerEvent(e);!this.inititatorDetector.isFirstNavigation()&&r?.element&&(n.data.click_source={section:r?.name,group:r?.group,url:r?.url,element:{id:r?.element?.id,name:r?.element?.name,node_type:r?.element?.nodeName,class_list:r?.element?.classList}}),this.env.win.dataLayer?.push(n)}}class qt{static commandMap=new Map([["event","event"],["send","event"],["set","set"],["state","set"]])}function Kt(e){if(null===e||"object"!=typeof e)return e;if("function"==typeof globalThis.structuredClone)try{return globalThis.structuredClone(e)}catch{console.warn("structuredClone failed, falling back to deepClonePruningNonStructured",e)}else try{return JSON.parse(JSON.stringify(e))}catch(e){console.warn("Deep clone failed using JSON fallback.",e)}return Wt(e)}function Wt(e,t=new WeakMap){if(null===e)return null;const n=typeof e;if("object"!==n){if("function"===n||"symbol"===n||"bigint"===n)return;return"number"!==n||Number.isFinite(e)?e:null}const r=e,i=t.get(r);if(i)return i;if(Array.isArray(r)){const e=new Array(r.length);t.set(r,e);for(let n=0;n<e.length;n+=1){const i=Wt(r[n],t);e[n]=void 0===i?null:i}return e}const s=Object.getPrototypeOf(r);if(s!==Object.prototype&&null!==s)return;const o={};t.set(r,o);for(const[e,n]of Object.entries(r)){const r=Wt(n,t);void 0!==r&&(o[e]=r)}return o}class Gt extends qt{plugins;pipes;defaultPipes;logger;date;config;stateService;transportService;constructor(e,t,n,r,i,s,o,a){super(),this.plugins=e,this.pipes=t,this.defaultPipes=n,this.logger=r,this.date=i,this.config=s,this.stateService=o,this.transportService=a;const c=this.getContext();e.init(c)}event(e){this.events([e])}events(e){this.processMessages("event",e)}set(e){"object"==typeof e&&e&&!Array.isArray(e)&&this.stateService.setState(e)}state(e){this.set(e)}cmd(e,...t){if(Array.isArray(e))return this.cmd(e[0],...e.slice(1));const n=e.split("."),r=this[Gt.commandMap.get(n[1]||n[0]||"")||n[0]||""];"function"==typeof r?r.apply(this,t):this.logger.warn("Tracker",`Analytics command '${e}' not found!`)}getContext(){return{config:this.config,tracker:this}}flush(){throw new Error("Method not implemented.")}processMessages(e,t){const n=this.getContext();if("event"===e){const r=t.map(n=>{try{t=Kt(n)}catch(e){console.error("The event provided has an incorrect schema.",e)}return{type:e,data:JSON.parse(JSON.stringify(n)),state:{},timestamp:this.date.now()}}).flatMap(e=>this.pipes.transform(e,n).map(e=>this.defaultPipes.transform(e,n)).flat().map(e=>this.defaultPipes.enrich(e,n)).map(e=>this.pipes.enrich(e,n)));this.transportService.send(r)}}}const Jt=new e("Window"),Xt=(new e("PERF_HOOKS"),new e("DATA_LAYER")),Yt=new e("INTERNAL_DATA_LAYER");const Zt={app:"",mode:"standard",app_version:"0",version:"1.94.15",logLevel:E.Error,locksMaxAge:864e5,storagePrefix:"paa_",keyPulseSyncCookie:"pulse-state",hashStoreStorageType:"persistent",stateStorageKey:"ss",handledErrorPrefix:"HANDLED ERROR >>>"},Qt={...Zt,transportTimeout:6e4,transportRetries:Number.POSITIVE_INFINITY,transportRetryBackoffMS:100,transportRetryBackoffMaxMS:3e4,pulseClientType:"browser",tabManagerStorageType:"tab",sessionStorageType:"persistent",initialDocURL:"",experimentStorageKey:"experiments",keySessionID:"sid",keyDeviceId:"did",trafficSourceDetectorStorageType:"persistent",cacheStorageType:"persistent"},en={...Qt,plugins:[],transformPipes:[],enrichmentPipes:[],sessionStorageType:"persistent",tabManagerStorageType:"tab",debug:[],storagePrefix:"paa_",tabOpenerDetectionTimeWindow:6e3,rumUnsafeRequestBodyMeasure:!0,rumReportOnce:[],rumReport:[],dataLayerKey:"dataLayer"},tn={...en,app:"",app_id:"",debug:[],locksMaxAge:864e5,dataLayerKey:"dataLayer",pulseClientType:"browser",rumUnsafeRequestBodyMeasure:!0,handledErrorPrefix:"HANDLED ERROR >>>",plugins:[],transformPipes:[],enrichmentPipes:[],storagePrefix:"paa_",logLevel:E.Error,version:"__version__",detectionTimeWindow:1e3,initialDocURL:"",initiatorStorageType:"persistent"};const nn=(new d).provide(function(e){return e.useFactory(ht,e=>e,[t]).useValue(Jt,window).useClass(mt,mt,[Jt]).useClass(Tt,Tt,[mt]).useClass(Mt,Mt,[Ut,mt,p]).useClass(Ut,Ut,[mt]).useFactory(Xt,(e,t)=>e.win[t.dataLayerKey],[mt,ht]).useFactory(Yt,e=>e.win.pulse?.q,[mt]).useClass(Bt,Bt,[mt]).useClass(Ye,Ye,[Qe,et]).useFactory(Ht,(e,t,n,r)=>new Ht(e(t.initiatorStorageType),n,r,t),[m,ht,Mt,S]).useFactory(Ft,(e,t,n,r,i)=>new Ft(e(t.initiatorStorageType),n,r,i,t),[m,ht,Ht,S,mt]).useClass(zt,zt,[mt,Ft]).useClass(vt,vt,[Bt,zt,Ht]).useClass(wt,wt,[Ut]).useClass(St,St,[Mt,mt]).useClass(Et,Et,[Mt,mt]).useClass(gt,gt,[]).useClass(yt,yt,[]).useClass(_t,_t,[Ye,mt]).useClass(kt,kt,[Mt,mt]).useClass(tt,tt,[]).useClass(st,at,[]).useClass(it,at,[]).useClass(pt,pt,[vt,wt,St,ht,Et,Yt,_t,kt,tt,Xt]).useClass(ft,ft,[yt,gt,st,it,ht]).useFactory(Gt,(e,t,n,r,i,s,o,a,c,u)=>{a.registerPipes(),c.registerPlugins();return new Gt(e,t,n,r,s,o,i,u)},[tt,st,it,T,ye,S,ht,ft,pt,Tt])}).beforeInit(function(e){return{...tn,...e,initialDocURL:window.paa?.idu}});class rn{unsafeShortHash(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return t>>>=0,t.toString(36)}}class sn{win;doc;navigator;landingUrl;constructor(e){this.win=e,this.doc=this.win.document,this.navigator=this.win.navigator,this.landingUrl=this.getInitialDocumentURL()}getInitialDocumentURL(){if("function"==typeof this.win.performance?.getEntries){const e=this.win.performance.getEntries().find(e=>"navigation"===e.entryType);if(e&&this.isValidURL(e.name))return e.name}return this.isValidURL(this.win.pulse?.idu)?this.win.pulse.idu:this.win.document.location.href}isValidURL(e){if("string"!=typeof e)return!1;try{const t=new URL(e);return Boolean(t.hostname)}catch{return!1}}}function on(e,t){return new Promise(n=>{const r=setTimeout(n,e);t&&(t.onabort=()=>{clearTimeout(r)})})}class an{env;uuid;lockManager;locks=new Map;constructor(e,t){this.env=e,this.uuid=t,this.lockManager=e.win.navigator.locks}async supported(){let e=!1;try{this.lockManager?.query&&(await(this.lockManager?.query()),e=!0)}catch{e=!1}return"function"==typeof this.lockManager?.request&&"function"==typeof this.lockManager?.query&&"function"==typeof this.env.win.AbortController&&e}async locked(e){if(!this.lockManager)throw new Error("Native LockManager not supported!");return(await this.lockManager.query()).held.some(t=>t.name===e)}request(e,t=1e3){if(!this.lockManager)throw new Error("Native LockManager not supported!");const n=new u,r=new u,i=new AbortController,s={signal:i.signal};let o=!1;return this.lockManager.request(e,s,()=>{o=!0;const t={name:e,id:this.uuid.generate(),clientId:"",createdDate:0,task:r};return this.locks.set(e,t),n.resolve(t),r.waitUntilResolved()}).catch(()=>n.resolve(null)),on(t).then(()=>{o||(i.abort(),n.resolve(null))}).catch(e=>{console.error(e)}),n.waitUntilResolved()}async release(e){if(!this.lockManager)throw new Error("Native LockManager not supported!");const t=this.locks.get(e.name);t&&t.id===e.id&&(t.task.resolve(),this.locks.delete(t.name))}}var cn=n(682),un=n.n(cn);const ln=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;const hn=function(e){return"string"==typeof e&&ln.test(e)},dn=[];for(let e=0;e<256;++e)dn.push((e+256).toString(16).slice(1));const pn=function(e,t=0){const n=function(e,t=0){return(dn[e[t+0]]+dn[e[t+1]]+dn[e[t+2]]+dn[e[t+3]]+"-"+dn[e[t+4]]+dn[e[t+5]]+"-"+dn[e[t+6]]+dn[e[t+7]]+"-"+dn[e[t+8]]+dn[e[t+9]]+"-"+dn[e[t+10]]+dn[e[t+11]]+dn[e[t+12]]+dn[e[t+13]]+dn[e[t+14]]+dn[e[t+15]]).toLowerCase()}(e,t);if(!hn(n))throw TypeError("Stringified UUID is invalid");return n};class fn{date;env;mersenne;nativePRNG;constructor(e,t){this.date=e,this.env=t,this.nativePRNG=this.getNativePRNG()}generate(){const e=this.date.now();return`a.${this.nativePRNG?"c":"m"}.${e.toString(36)}.${this.generateV4()}`}generateV4(){const e=this.randomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,pn(e)}randomValues(e){if(this.nativePRNG)return this.nativePRNG(e);this.mersenne||(this.mersenne=new(un())(this.weakSeed()));let t=e.length;for(;t--;)e[t]=Math.floor(256*this.mersenne.random());return e}weakSeed(){const e=Array(127).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER));return[this.date.now(),...e]}getNativePRNG(){const e=this.env.win;return e.crypto?.getRandomValues?.bind(e.crypto)||e.msCrypto?.getRandomValues?.bind(e.msCrypto)||void 0}}class mn{storage;date;config;uuid;id;locks;constructor(e,t,n,r,i){this.storage=e,this.date=t,this.config=n,this.uuid=r,this.id=r.generate(),this.locks=this.syncLocks(),this.storage.change("locks",k.Full,_.External).subscribe(e=>{this.syncLocks(e.value)}),i.legacyOnUnload().subscribe(()=>this.releaseAll())}async release(e,t=!0){const n=this.locks.get(e.name);n&&n.clientId===this.id&&n.id===e.id&&(this.locks.delete(n.name),t&&this.syncLocks())}async locked(e){return this.locks.has(e)}async request(e,t=100,n=10){const r=this.date.now();for(;;){const i=await this.lock(e),s=this.date.now()-r>t;if(i||s)return i;await on(n)}}async lock(e){if(this.locks.has(e))return null;{const t={name:e,clientId:this.id,id:this.uuid.generate(),createdDate:this.date.now()};return this.locks.set(e,t),this.syncLocks(),t}}syncLocks(e){if(!this.locks||e){const t=e||this.storage.get("locks"),n=JSON.parse(t||"null"),r=new Map(n||[]),i=this.releaseExpiredLocks(r);this.locks=i,r.size!==i.size&&this.writeLocks(i)}else this.writeLocks(this.locks);return this.locks}writeLocks(e){0===e.size?this.storage.remove("locks"):this.storage.setJSON("locks",Array.from(e))}releaseAll(){for(const[e,t]of this.locks)t.clientId===this.id&&this.release(t,!1);this.syncLocks()}releaseExpiredLocks(e){const t=this.date.now(),n=Array.from(e).filter(([e,n])=>t-n.createdDate<this.config.locksMaxAge);return new Map(n)}}class gn{parseCookies(e){const t=[],n=e.split(";");for(const e of n){const n={},r=e.indexOf("=");r>-1?(n.name=e.slice(0,r).trim()||"",n.value=e.slice(r+1).trim()):(n.name="",n.value=e.trim()),n.name&&(n.name=(n.name||"").replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),n.value=(n.value||"").replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),t.push(n))}return t}serializeSetCookie(e){if(!e.name||"string"!=typeof e.name)throw new Error("Invalid cookie name!");const t={...e},n=encodeURIComponent(t.name).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),r=encodeURIComponent(t.value||"").replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),i=this.serializeExpires(t.expires),s=[`${n}=${r}`];if("string"==typeof i&&s.push(`Expires=${i}`),"string"==typeof t.domain&&s.push(`Domain=${t.domain}`),s.push(`Path=${t.path||"/"}`),"string"==typeof e.sameSite){const n=e.sameSite.toUpperCase();"LAX"===n?s.push("SameSite=Lax"):"STRICT"===n?s.push("SameSite=Strict"):"NONE"===n&&(s.push("SameSite=None"),t.secure=!0)}return!0===t.secure&&s.push("Secure"),s.join("; ")}serializeExpires(e){if(Number.isSafeInteger(e)){const t=new Date(e);if(!isNaN(Number(t)))return t.toUTCString()}}parseExpires(e){if("string"==typeof e){const t=Date.parse(e);if(Number.isSafeInteger(t))return t}}}class yn{options;changes=new pe;constructor(e){this.options=e}change(e,t=k.Full,n=_.External){let r=this.changes.asObservable().pipe(Ve(({external:e})=>n===_.All||(n===_.External?e:!e)));if(e)if(t&&t!==k.Full){if(t!==k.Start)throw new Error("Invalid keyMatch value!");r=r.pipe(Ve(t=>t.key.startsWith(e)))}else r=r.pipe(Ve(t=>t.key===e));return r}getJSON(e){const t=this.get(e);return"string"==typeof t?JSON.parse(t):null}setJSON(e,t){const n=JSON.stringify(t);this.set(e,n)}getStorageKey(e){const t=this.options.storagePrefix;return t?`${t}${e}`:e}revertStorageKey(e){const t=this.options.storagePrefix;return t?.length?e.slice(this.options.storagePrefix.length):e}isStorageKey(e){return!this.options.storagePrefix||!e||e.startsWith(this.options.storagePrefix)}emitChange(e){this.changes.next(e)}}class vn extends yn{db=new Map;freeSpace$=new pe;constructor(){super({storagePrefix:""})}get(e){return this.db.get(e)??null}set(e,t,n=!1){this.db.set(e,t),this.emitChange({key:e,value:t,external:n})}keys(){return Array.from(this.db.keys())}remove(e){this.db.delete(e),this.emitChange({key:e,value:null,external:!1})}clear(){this.db=new Map}all(){return Array.from(this.db.entries()).reduce((e,[t,n])=>(e[t]=n,e),{})}}class bn{documentVisibility;env;date;logger;config;deviceIdService;get async(){return this.documentVisibility.visible}timeoutLimit=2e4;constructor(e,t,n,r,i,s){this.documentVisibility=e,this.env=t,this.date=n,this.logger=r,this.config=i,this.deviceIdService=s}async get(e,t,n){return this.retry(()=>this.trySendGetRequest(e,t,n),this.config.transportRetries,this.config.transportTimeout)}async post(e,t,n,r=!1){return await this.retry(()=>this.trySendPostRequest(e,t,r,n),this.config.transportRetries,this.config.transportTimeout)}async put(e,t,n){return(await this.env.win.fetch(e,{method:"PUT",headers:t,body:JSON.stringify(n)})).json()}async delete(e,t){return(await this.env.win.fetch(e,{method:"DELETE",headers:t})).json()}async retry(e,t=Number.MAX_SAFE_INTEGER,n=6e4){const r=this.date.now();let i=0;for(;;){const s=i<t;if(this.date.now()-r>n)throw new Error("Timedout!");if(!s)throw new Error("Max retries exeeded!");this.env.navigator.onLine||void 0===this.env.win.navigator.onLine||await this.waitForNetwork();try{const t=await e();if(t)return t;throw new Error("Request Failed!")}catch(e){this.logger.error(e);const t=this.backoffTime(++i);await on(t)}}}waitForNetwork(){return new Promise(e=>{if(this.env.win.navigator.onLine)return e();this.env.win.addEventListener("online",()=>{e()})})}succeeded(e){return"boolean"==typeof e?e:e>=200&&e<=400}backoffTime(e){if(!this.async&&e<10)return 0;const t=Math.floor(Math.pow(1e3,e/50)*this.config.transportRetryBackoffMS);return Math.min(this.config.transportRetryBackoffMaxMS,t)}fetchPossible(){const e=this.env.win,t="Request"in e&&"boolean"==typeof new Request("https://t.picsart.com").keepalive;return!("function"!=typeof e.fetch||!("AbortController"in e)||!this.async&&!t)}sendBeacon(e,t){return this.env.win.navigator.sendBeacon(`${t}/beacon`,e)}async trySendGetRequest(e,t,n){let r;if(this.env.win.navigator.onLine||void 0===this.env.win.navigator.onLine||await this.waitForNetwork(),this.fetchPossible()){const i=new AbortController,s=setTimeout(()=>i.abort(),this.timeoutLimit),o={method:"GET",headers:t,credentials:"include",signal:i.signal};"high"===n&&(o.priority=n);const a=await this.env.win.fetch(e,o);if(clearTimeout(s),!a)return{ok:!1,body:void 0,headers:new Map,status:400};const c=await(a?.json()),u=new Map(a.headers.entries());r={ok:a.ok,body:c,headers:u,status:a?.status},"object"==typeof r&&r?.headers.has("paa-did")&&this.replaceDeviceId(r.headers.get("paa-did"))}else r=await this.sendGetXHR(e,t,!0);return r}async trySendPostRequest(e,t,n,r){let i;if(this.env.win.navigator.onLine||void 0===this.env.win.navigator.onLine||await this.waitForNetwork(),this.fetchPossible()){let s,o,a;try{if(s=await this.env.win.fetch(`${e}/fetch`,{method:"POST",headers:t,body:JSON.stringify(r),credentials:"include",keepalive:n}),o=new Map(s.headers.entries()),a=await s.json(),s.status>=500)return!1;i={ok:4===s.status,body:a.body,headers:o,status:s.status}}catch{return!1}"object"==typeof i&&i?.headers.has("paa-did")&&this.replaceDeviceId(i.headers.get("paa-did"))}else if(n&&"function"==typeof this.env.win.navigator?.sendBeacon){if(this.sendBeacon(JSON.stringify(r),e))return!0;i=await this.sendPostXHR(JSON.stringify(r),!0,t,e)}else i=await this.sendPostXHR(JSON.stringify(r),!0,t,e);return i}async sendGetXHR(e,t,n){const r=this.env,i=this.config,s=new Promise((s,o)=>{try{const o=new r.win.XMLHttpRequest;n&&(o.timeout=i.transportTimeout,o.onreadystatechange=()=>{this.requestStateChange(o,s)}),o.open("GET",`${e}`,n),o.withCredentials=!0,o.timeout=this.timeoutLimit;for(const e in t)o.setRequestHeader(e,String(t[e]));o.send()}catch(e){o(e)}});return await s}sendPostXHR(e,t,n,r){return new Promise((i,s)=>{try{const s=new this.env.win.XMLHttpRequest;t&&(s.timeout=this.config.transportTimeout,s.onreadystatechange=()=>{this.requestStateChange(s,i)}),s.open("POST",`${r}/xhr`,t),s.withCredentials=!0;for(const e in n)s.setRequestHeader(e,String(n[e]));s.send(e),t||i(s.response)}catch(e){s(e)}})}requestStateChange(e,t){if(4===e.readyState){const n=this.succeeded(e.status),r=new Map;let i;e.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((e,t)=>{r.set(t.toString(),e)});try{i=JSON.parse(e.response)}catch{throw new Error(`${e.response} is not a JSON!`)}const s={ok:n,status:e.status,body:i,headers:r};"object"==typeof s&&s?.headers.has("paa-did")&&this.replaceDeviceId(r.get("paa-did")),t(s)}}replaceDeviceId(e){e&&this.deviceIdService.setDeviceId(e)}}class wn{uuid;storage;cookieStorage;config;webToMobileService;storageChange;deviceId="";deviceIdSubject$=new ge(1);constructor(e,t,n,r,i,s){this.uuid=e,this.storage=t,this.cookieStorage=n,this.config=r,this.webToMobileService=i,this.storageChange=s,this.cookieStorage.remove(this.config.keyDeviceId),this.registerStorageChangeListeners(),this.setDeviceId(this.fetchDeviceId().trim())}getDeviceId(){return this.deviceId}getDeviceId$(){return this.deviceIdSubject$.asObservable()}setDeviceId(e){if(e===this.deviceId||"string"!=typeof e||!e.trim())return;let t;const n=e.trim(),r=this.webToMobileService.getWebToMobileMetaInfo();t=r?.device_id?String(r.device_id):n;this.storage.get(this.config.keyDeviceId)!==t&&this.storage.set(this.config.keyDeviceId,t),this.deviceId=t,this.deviceIdSubject$.next(t)}generateDeviceId(){return this.uuid.generate()}registerStorageChangeListeners(){this.storage.change(this.config.keyDeviceId,k.Full,this.storageChange).subscribe(({value:e})=>{this.setDeviceId(e||"")})}fetchDeviceId(){return this.storage.get(this.config.keyDeviceId)||this.generateDeviceId()}}class Sn{env;registeredConrols=new Map;debugCtrlIconKey="pulse-debug-ctrl-icon";experimentIcon=`<svg class="${this.debugCtrlIconKey}"  width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                <path d="M9 2C9 1.44772 9.44772 1 10 1H14C14.5523 1 15 1.44772 15 2V3C15 3.55228 14.5523 4 14 4H10C9.44772 4 9 3.55228 9 3V2Z" fill="#ff6d91"/>\n                                <path d="M6 8V6C6 5.44772 6.44772 5 7 5H17C17.5523 5 18 5.44772 18 6V8C18 8.55228 17.5523 9 17 9H7C6.44772 9 6 8.55228 6 8Z" fill="#ff6d91"/>\n                                <path d="M8 9H16L20 17C21 19 19.5 21 17 21H7C4.5 21 3 19 4 17L8 9Z" stroke="#ff6d91" stroke-width="2"/>\n                                <path d="M19 3H21M20 2V4M4 3H6M5 2V4M16 5H18M17 4V6" stroke="#ff6d91" stroke-width="2" stroke-linecap="round"/>\n                            </svg>`;debugIcon=`<svg class="${this.debugCtrlIconKey}" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M10 2C9.44772 2 9 2.44772 9 3V4.07071C7.2845 4.55606 6 6.13616 6 8V10H4C3.44772 10 3 10.4477 3 11C3 11.5523 3.44772 12 4 12H6V14H4C3.44772 14 3 14.4477 3 15C3 15.5523 3.44772 16 4 16H6V18C6 19.8638 7.2845 21.4439 9 21.9293V23C9 23.5523 9.44772 24 10 24C10.5523 24 11 23.5523 11 23V22H13V23C13 23.5523 13.4477 24 14 24C14.5523 24 15 23.5523 15 23V21.9293C16.7155 21.4439 18 19.8638 18 18V16H20C20.5523 16 21 15.5523 21 15C21 14.4477 20.5523 14 20 14H18V12H20C20.5523 12 21 11.5523 21 11C21 10.4477 20.5523 10 20 10H18V8C18 6.13616 16.7155 4.55606 15 4.07071V3C15 2.44772 14.5523 2 14 2C13.4477 2 13 2.44772 13 3V4H11V3C11 2.44772 10.5523 2 10 2Z" fill="#ff6d91"/>\n                            <circle cx="17" cy="17" r="5" stroke="#ff6d91" stroke-width="2"/>\n                            <line x1="20.5" y1="20.5" x2="23" y2="23" stroke="#ff6d91" stroke-width="2"/>\n                        </svg>`;copyIcon=function(e){return`<svg \n            class="pulse-debug-ctrl-copy-icon"\n            onclick="(()=>{\n                try {\n                    navigator.clipboard.writeText('${e}');\n                } catch (err) {\n                    console.log('Failed to copy:', err);\n                }\n            })()" \n            width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <rect x="8" y="4" width="12" height="14" rx="2" stroke="#ff6d91" stroke-width="2"/>\n            <path d="M6 8H5C3.89543 8 3 8.89543 3 10V18C3 19.1046 3.89543 20 5 20H13C14.1046 20 15 19.1046 15 18V17" stroke="#ff6d91" stroke-width="2"/>\n        </svg>`};constructor(e){this.env=e}registerControl({control:e,content:t,url:n,title:r="",deviceId:i="",callbackFn:s}){this.registeredConrols.has(e)||this.registeredConrols.set(e,this.displayControls({controlName:e,content:t,url:n,title:r,deviceId:i,callbackFn:s}))}unregisterControl(e){const t=this.registeredConrols.get(e);t&&(this.animateOut(t),this.registeredConrols.delete(e))}displayControls({controlName:e,content:t,url:n,title:r,deviceId:i,callbackFn:s}){const o=this.createElements({controlName:e,content:t,url:n,title:r,deviceId:i});return o.button.addEventListener("click",()=>{s()}),this.addStyles(e),this.animateIn(o),o}async animateIn(e){window.document.body.appendChild(e.fragment),await on(10),e.container.classList.add("active"),await on(500),e.container.classList.add("animate"),await on(1500),e.container.classList.remove("animate")}async animateOut(e){e.container.classList.remove("active"),await on(1e3),this.env.win.location.reload()}createElements({controlName:e,content:t,url:n,title:r,deviceId:i}){const s=window.document;let o,a;switch(e){case"experiment":o=this.experimentIcon,a="Exit preview";break;case"debug":o=this.debugIcon,a="Exit from debug mode"}const c=`${o}<div class="pulse-debug-ctrl-${e}-details">\n                                <div class="pulse-debug-ctrl-${e}-title">\n                                    <a href="${n}" title="${r}" target="_blank">${t}</a>\n                                </div>\n                            <div>\n                            ${i?`<p class="pulse-debug-ctrl-${e}-device-id">${i} ${this.copyIcon(i)}</p>`:""}\n                            <button>${a}</button>\n                            </div>\n                            </div>`,u=s.createElement("div");u.classList.add(`pulse-debug-ctrl-${e}-badge`),u.innerHTML=c;const l=s.createDocumentFragment();l.appendChild(u);const h=l.querySelector(`.pulse-debug-ctrl-${e}-details button`);return{container:u,fragment:l,button:h}}addStyles(e){const t=`\n        .pulse-debug-ctrl-${e}-badge {\n            display: flex;\n            position: fixed;\n            z-index: 9999999999;\n            box-sizing: border-box;\n            align-items: center;\n            width: 310px;\n            height: 60px;\n            bottom: ${"debug"===e?"55vh":"48vh"};\n            right: 0;\n            border: solid 1px #ff6d91;\n            border-right: none;\n            border-radius: 1000px;\n            border-top-right-radius: 0;\n            border-bottom-right-radius: 0;\n            box-shadow: 0 2px 25px rgba(255, 0, 130, 0.1);\n            color: #fff;\n            text-align: center;\n            font-family: sans-serif;\n            font-size: 10px;\n            background-color: #1b1b1b;\n            -webkit-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n            transition: transform 0.2s;\n            transform: translateX(345px);\n        }\n\n        .pulse-debug-ctrl-${e}-badge .pulse-debug-ctrl-copy-icon{\n            cursor: pointer;\n        }\n\n        .pulse-debug-ctrl-${e}-badge .${this.debugCtrlIconKey} {\n            margin: 0 10px 0 10px;\n        }\n\n        .pulse-debug-ctrl-${e}-badge.active {\n            transition-delay: 0.5s;\n            transform: translateX(275px);\n        }\n\n        .pulse-debug-ctrl-${e}-badge.active:hover {\n            transform: translateX(0);\n        }\n\n        .pulse-debug-ctrl-${e}-badge .pulse-debug-ctrl-${e}-details {\n            width: 10px;\n            flex-grow: 1111;\n        }\n        \n        .pulse-debug-ctrl-${e}-badge .pulse-debug-ctrl-${e}-device-id {\n            margin: 0px 0px 3px 0px;\n        }\n\n        .pulse-debug-ctrl-${e}-device-id {\n            cursor: pointer;\n        }\n\n        .pulse-debug-ctrl-${e}-badge .pulse-debug-ctrl-${e}-title {\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            width: 100%;\n            text-align: center;\n            padding: 0;\n            margin: 0 0 3px 0;\n            display: block;\n        }\n\n        .pulse-debug-ctrl-${e}-badge .pulse-debug-ctrl-${e}-title a {\n            color: #fff;\n            text-decoration: none;\n            padding: 0;\n            margin: 0;\n        }\n\n        .pulse-debug-ctrl-${e}-badge .pulse-debug-ctrl-${e}-title a:hover {\n            text-decoration: underline;\n        }\n\n        .pulse-debug-ctrl-${e}-badge button {\n            padding: 1px 5px;\n            border: solid 1px #ff6d91;\n            border-radius: 3px;\n            cursor: pointer;\n            background: none;\n            color: #ff6d91;\n            font-size: 10px;\n            transition: all 0.15s;\n        }\n\n        .pulse-debug-ctrl-${e}-badge button:hover {\n            color: #fff;\n            background-color: #bb1367;\n            border: solid 1px #bb1367;\n        }\n\n        .pulse-debug-ctrl-${e}-badge:before,\n        .pulse-debug-ctrl-${e}-badge:after {\n            position: absolute;\n            content: "";\n            display: block;\n            width: 140%;\n            height: 100%;\n            left: -20%;\n            z-index: -1000;\n            transition: all ease-in-out 0.5s;\n            background-repeat: no-repeat;\n        }\n\n        .pulse-debug-ctrl-${e}-badge:before {\n            display: none;\n            top: -75%;\n            background-image: radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, transparent 20%, #ff0081 20%, transparent 30%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, transparent 10%, #ff0081 15%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%);\n            background-size: 10% 10%, 20% 20%, 15% 15%, 20% 20%, 18% 18%, 10% 10%, 15% 15%, 10% 10%, 18% 18%;\n        }\n\n        .pulse-debug-ctrl-${e}-badge:after {\n            display: none;\n            bottom: -75%;\n            background-image: radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, transparent 10%, #ff0081 15%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%),\n                            radial-gradient(circle, #ff0081 20%, transparent 20%);\n            background-size: 15% 15%, 20% 20%, 18% 18%, 20% 20%, 15% 15%, 10% 10%, 20% 20%;\n        }\n\n        .pulse-debug-ctrl-${e}-badge.animate:before {\n            display: block;\n            animation: topBubbles ease-in-out 0.75s forwards;\n        }\n\n        .pulse-debug-ctrl-${e}-badge.animate:after {\n            display: block;\n            animation: bottomBubbles ease-in-out 0.75s forwards;\n        }\n\n        @keyframes topBubbles {\n            0% {\n                background-position: 5% 90%, 10% 90%, 10% 90%, 15% 90%, 25% 90%, 25% 90%, 40% 90%, 55% 90%, 70% 90%;\n            }\n            50% {\n                background-position: 0 80%, 0% 20%, 10% 40%, 20% 0%, 30% 30%, 22% 50%, 50% 50%, 65% 20%, 90% 30%;\n            }\n            100% {\n                background-position: 0 70%, 0% 10%, 10% 30%, 20% -10%, 30% 20%, 22% 40%, 50% 40%, 65% 10%, 90% 20%;\n                background-size: 0 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%;\n            }\n        }\n\n        @keyframes bottomBubbles {\n            0% {\n                background-position: 10% -10%, 30% 10%, 55% -10%, 70% -10%, 85% -10%, 70% -10%, 70% 0%;\n            }\n            50% {\n                background-position: 0 80%, 20% 80%, 45% 60%, 60% 100%, 75% 70%, 95% 60%, 105% 0%;\n            }\n            100% {\n                background-position: 0 90%, 20% 90%, 45% 70%, 60% 110%, 75% 80%, 95% 70%, 110% 10%;\n                background-size: 0 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%;\n            }\n        }\n        `,n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.appendChild(document.createTextNode(t)),n.appendChild(r)}}class En{env;page;constructor(e,t){this.env=e,this.page=t}cleanupURL(e){const t=this.page.url();t.searchParams.has(e)&&(t.searchParams.delete(e),this.env.win.history.replaceState(this.env.win.history.state,this.env.doc.title,t.href))}}class _n{env;constructor(e){this.env=e}host(){return this.env.win.location.host}landingPageUrl(){return this.env.landingUrl.toLowerCase()}referrer(){return this.env.doc.referrer}href(){return this.env.win.location.href}url(){return new URL(this.env.win.location.href)}}class kn extends yn{env;parser;changeDetector;freeSpace$=new pe;cookies=new Map;constructor(e,t,n,r){super(r),this.env=e,this.parser=t,this.changeDetector=n,this.pull(!1),this.changeDetector.changes().pipe(Ve(e=>e||!r.storagePrefix)).subscribe(()=>this.pull())}get(e){return this.cookies.get(e)??null}set(e,t){const n={name:this.getStorageKey(e),value:t};this.cookies.set(e,t);const r=this.parser.serializeSetCookie(n);this.env.doc.cookie=r,this.emitChange({key:e,value:t,external:!1})}keys(){return Array.from(this.cookies.keys())}remove(e){const t={name:this.getStorageKey(e),value:"",expires:0};this.cookies.delete(e);const n=this.parser.serializeSetCookie(t);this.env.doc.cookie=n,this.emitChange({key:e,value:null,external:!1})}clear(){const e=this.keys();for(const t of e)this.remove(t)}all(){return Array.from(this.cookies).reduce((e,[t,n])=>("string"==typeof n&&(e[t]=n),e),{})}pull(e=!0){const t=this.cookies,n=this.fetchCookies(),r=new Set([...t.keys(),...n.keys()]);if(this.cookies=n,e)for(const e of r){const r=t.get(e),i=n.get(e)??null;if(r!==i){const t={key:e,value:i,external:!0};this.emitChange(t)}}}fetchCookies(){const e=this.env.doc,t=this.parser.parseCookies(e.cookie).filter(e=>this.isStorageKey(e.name));for(const e of t)e.name=this.revertStorageKey(e.name);const n=t.map(e=>[e.name,e.value]);return new Map(n)}}class Tn{env;static patchedDocuments=new Map;constructor(e,t){this.env=t;const n=this.patchChanges();n.pipe(Ve(e=>!e)).subscribe(()=>{e.postMessage(!0)}),e.messages.pipe(Ue(()=>!0)).subscribe(n)}changes(){return this.patchChanges()}patchChanges(){const e=this.env.doc;let t=Tn.patchedDocuments.get(e);if(t)return t;t=new pe,Tn.patchedDocuments.set(e,t);const n=this.env.win.Document.prototype,r=Object.getOwnPropertyDescriptor(n,"cookie");let i=e.cookie;const s={enumerable:!0,configurable:!0,get:()=>e.__native_cookie,set:n=>{e.__native_cookie=n;const r=e.__native_cookie;if(r!==i)try{t.next(!1)}finally{i=r}}};return Object.defineProperty(n,"__native_cookie",r),Object.defineProperty(n,"cookie",s),t}}class Cn{cookieStorage;KEY_W2M_META_INFO="w2m_meta_info";w2mMetaInfo;constructor(e){this.cookieStorage=e;try{const e=this.cookieStorage.get(this.KEY_W2M_META_INFO);e&&(this.w2mMetaInfo=JSON.parse(e))}catch(e){console.error("Error getting web to mobile configuration",e)}}getWebToMobileMetaInfo(){return this.w2mMetaInfo?this.w2mMetaInfo:null}}class Nn{env;constructor(e){this.env=e}pushData(e){this.env.win.dataLayer||(this.env.win.dataLayer=[]),this.env.win.dataLayer.push(e)}}function xn(e){return"object"==typeof e&&e?Array.isArray(e)?e.map(e=>xn(e)):Object.keys(e).sort().reduce((t,n)=>(t[n]=xn(e[n]),t),{}):e}class Pn{storage;crypto;date;KEY_ATTR_HASHES="hs";hashes=new Map;constructor(e,t,n){this.storage=e,this.crypto=t,this.date=n,this.refresh(),this.storage.change(this.KEY_ATTR_HASHES).subscribe(e=>this.refresh(e.value))}changed(e,t,n,r=!0){let i;i=null===t?"null":void 0===t?"undefined":"object"==typeof t?JSON.stringify(xn(t)):"string"==typeof t?t:JSON.stringify(t);const s=this.date.now(),o=this.crypto.unsafeShortHash(e),a=this.crypto.unsafeShortHash(i),c=this.hashes.get(o),[u,l]=(c||"").split("."),h=parseInt(l||"0",36);return!(u===a&&(!n||h&&!(s-h>n)))&&(this.hashes.set(o,`${a}.${s.toString(36)}`),this.persist(),!(!r&&!c))}refresh(e){let t=e?JSON.parse(e):this.storage.getJSON(this.KEY_ATTR_HASHES);t&&Array.isArray(t.hs)||(t={hs:[]},this.storage.setJSON(this.KEY_ATTR_HASHES,t)),this.hashes=new Map(t.hs)}persist(){const e={hs:Array.from(this.hashes)};this.storage.setJSON(this.KEY_ATTR_HASHES,e)}}class In{env;constructor(e){this.env=e}push(e){this.env.win?.dataLayer&&this.env.win.dataLayer.push(e)}}function On(e){const t=e.toLowerCase(),n=t.indexOf("?");return t.substring(0,n+1)+t.substring(n+1).split(/[#?]/g).join("&")}class Ln{page;constructor(e){this.page=e}getUTMParams(){const e=new URL(On(this.page.landingPageUrl())),t=e.searchParams.get("utm_source"),n=e.searchParams.get("utm_medium"),r=e.searchParams.get("utm_campaign"),i=e.searchParams.get("utm_term")||"",s=e.searchParams.get("utm_content")||"";if(t||r)return{utm_source:t||void 0,utm_medium:n||void 0,utm_campaign:r||void 0,utm_term:i||void 0,utm_content:s||void 0}}}class An{utmService;storage;page;trafficSourceSubject$=new ge(1);constructor(e,t,n){this.utmService=e,this.storage=t,this.page=n;const r=this.getStoredTrafficSource();r&&this.trafficSourceSubject$.next(r)}getTrafficSource(){const e=this.utmService.getUTMParams(),t=this.getReferrer(),n=this.getClickId(t?.url),r=this.page.landingPageUrl();return e||n||t?{utmParams:e,clickId:n,referrer:t,landingPageURL:r}:null}getLastTrafficSource(){const e=this.getStoredTrafficSource(),t=this.getTrafficSource(),n=t?.referrer?.internal??!1;return this.changed(t?.clickId,e?.clickId)||this.changed(t?.utmParams,e?.utmParams)||this.changed(t?.referrer,e?.referrer)&&!n?(this.storage.setJSON("traffic_source",t),this.trafficSourceSubject$.next(t),t):e}getLastTrafficSource$(){return this.trafficSourceSubject$.asObservable()}getStoredTrafficSource(){return this.storage.getJSON("traffic_source")}getClickId(e){const{searchParams:t}=new URL(On(this.page.landingPageUrl())),n=t.get("gclid"),r=t.get("gclsrc")||t.get("wbraid")||t.get("gbraid"),i=t.get("msclkid"),s=t.get("fbclid"),o=t.get("yclid"),a=e?.includes("yahoo")?"yahoo":"yandex",c=t.get("dclid"),u=t.get("li_fat_id"),l=t.get("ttclid"),h=t.get("twclid");let d,p;return n?(d=n,p=r?`google.${r}`:"google"):s?(d=s,p="facebook"):i?(d=i,p="microsoft"):o?(d=o,p=a):c?(d=c,p="doubleclick"):u?(d=u,p="linkedin"):l?(d=l,p="tiktok"):h&&(d=h,p="twitter"),d&&p?{value:d,source:p}:void 0}getReferrer(){const e=this.page.referrer()||"";if(e)return{url:e,internal:this.isInternalURL(e)}}isInternalURL(e){return new URL(e).host===this.page.url().host}changed(e,t){return e&&!C(e,t)}}class Rn extends yn{storageArea;quote;freeSpace$=new pe;availableSpace=void 0;constructor(e,t,n,r){super(r),this.storageArea=t,this.quote=n,this.calculateAvailableSpace(),Ot(e.win,"storage").pipe(Ve(e=>Boolean(e.key)&&e.storageArea===t&&this.isStorageKey(e.key)),Ue(e=>({key:this.revertStorageKey(e.key),value:e.newValue,external:!0}))).subscribe(e=>this.emitChange(e))}get(e){return this.storageArea.getItem(this.getStorageKey(e))}set(e,t){try{const n=(new TextEncoder).encode(t).length;null!==this.availableSpace&&void 0!==this.availableSpace&&this.availableSpace-n>100||null===this.availableSpace||void 0===this.availableSpace?(this.storageArea.setItem(this.getStorageKey(e),t),this.emitChange({key:e,value:t,external:!1})):this.freeSpace()}catch(e){this.freeSpace(),console.warn(e)}finally{this.calculateAvailableSpace()}}keys(){return Object.keys(this.storageArea).filter(e=>this.isStorageKey(e)).map(e=>this.revertStorageKey(e))}remove(e){this.storageArea.removeItem(this.getStorageKey(e)),this.emitChange({key:e,value:null,external:!1})}clear(){const e=this.keys();for(const t of e)this.remove(t)}all(){return Object.keys(this.storageArea).filter(e=>this.isStorageKey(e)).reduce((e,t)=>{const n=this.revertStorageKey(t),r=this.storageArea.getItem(t);return"string"==typeof r&&(e[n]=r),e},{})}freeSpace(){this.freeSpace$.next()}async calculateAvailableSpace(){this.availableSpace=await this.quote.quoteSize()}}class Mn extends Rn{constructor(e,t,n,r){super(e,o(e.win)?e.win.localStorage:r,n,t)}}class Dn{env;constructor(e){this.env=e}async quoteSize(){return new Promise(e=>{try{"function"==typeof this.env.navigator?.storage?.estimate?navigator?.storage.estimate().then(t=>{e(t?.quota)}).catch(t=>{console.error(t),e(null)}):e(null)}catch(t){console.error(t),e(null)}})}}class jn extends Rn{constructor(e,t,n,r){super(e,o(e.win)?e.win.sessionStorage:r,n,t)}}class Vn{persistentStorage;env;messages=new pe;nativeChannel;channelName;constructor(e,t,n){this.persistentStorage=t,this.env=n,this.channelName=`pulse_bc_${e}`,this.init()}postMessage(e){this.nativeChannel?this.nativeChannel.postMessage(e):this.persistentStorage.setJSON(this.channelName,e)}init(){if(this.env.win.BroadcastChannel)return this.nativeChannel=new this.env.win.BroadcastChannel(this.channelName),void this.nativeChannel.addEventListener("message",e=>{this.messages.next(e.data)});this.persistentStorage.change(this.channelName,k.Full,_.External).subscribe(e=>{const t=JSON.parse(e.value||"null");this.messages.next(t)})}}var Un=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return x(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(pe);function Bn(e){return Ie(function(t,n){var r,i=null,s=!1;i=t.subscribe(Oe(n,void 0,void 0,function(o){r=Ne(e(o,Bn(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(n))})}class Hn{env;_db;connectionState$=new Un("NOT_CONNECTED");storeList=["settingsStore","attributesStore"];pulseDB="pulseDB";get db(){if(!this._db)throw Error("IndexDB store not exist ");return this._db}constructor(e){this.env=e}async truncate(e){if(!c(this.env.win))return;const t=await this.getTransaction(e,"readwrite");return new Promise((n,r)=>{try{const i=t.objectStore(e).clear();i.onerror=e=>{this.logerr(e),r(e)},i.onsuccess=()=>{n(i.result)}}catch(e){r(e)}})}async getValue(e,t){if(!c(this.env.win))return;const n=await this.getTransaction(e,"readonly");return new Promise((r,i)=>{try{const i=n.objectStore(e).get(t);i.onerror=this.logerr,i.onsuccess=()=>{r(i.result)}}catch(e){i(e)}})}async getAllValue(e){if(!c(this.env.win))return Promise.resolve();const t=await this.getTransaction(e,"readonly");return new Promise((n,r)=>{try{const r=t.objectStore(e).getAll();r.onerror=this.logerr,r.onsuccess=()=>{n(r.result)}}catch(e){r(e)}})}async putValue(e,t){if(!c(this.env.win))return Promise.resolve(!1);const n=await this.getTransaction(e,"readwrite");return new Promise((r,i)=>{try{const i=n.objectStore(e).put(t);i.onsuccess=()=>{r(!0)},i.onerror=this.logerr}catch(e){i(e)}})}async putBulkValue(e,t){if(!c(this.env.win))return;const n=(await this.getTransaction(e,"readwrite")).objectStore(e);for(const e of t)n.put(e);return await this.getAllValue(e)}async deleteValue(e,t){if(!c(this.env.win))return;const n=await this.getTransaction(e,"readwrite");return new Promise((r,i)=>{try{const i=n.objectStore(e),s=i.get(t);s.onsuccess=()=>{s.result||r("-1"),i.delete(t).onsuccess=()=>r(t)},s.onerror=this.logerr}catch(e){i(e)}})}async connectDB(){if(!c(this.env.win))return;this.connectionState$.next("CONNECTING");const e=this.env.win.indexedDB.open(this.pulseDB,1);return new Promise((t,n)=>{try{e.onerror=e=>{this.connectionState$.next("NOT_CONNECTED"),this.logerr(e)},e.onsuccess=()=>{this.createObjectStore(e.result),t(e.result)},e.onupgradeneeded=e=>{e.target&&e.target?.result&&this.createObjectStore(e.target?.result)}}catch(e){this.connectionState$.next("NOT_CONNECTED"),n(e)}})}logerr(e){console.warn(e)}createObjectStore(e){this.storeList.forEach(t=>{if(!e.objectStoreNames.contains(t)){const n=e.createObjectStore(t,{autoIncrement:!1,keyPath:"id"});n.createIndex("id","id",{unique:!0}),n.createIndex("time","time",{unique:!1}),n.createIndex("id_time",["id","time"],{unique:!0})}}),this._db=e,this.connectionState$.next("CONNECTED"),this.db.onclose=this.reconnectDB.bind(this),this.db.onabort=this.reconnectDB.bind(this)}getTransaction(e,t,n){if("CONNECTED"===this.connectionState$.getValue())try{return Promise.resolve(this.db.transaction(e,t,n))}catch(e){console.warn(e),this.connectDB()}return function(e,t){var n="object"==typeof t;return new Promise(function(r,i){var s=new re({next:function(e){r(e),s.unsubscribe()},error:i,complete:function(){n?r(t.defaultValue):i(new We)}});e.subscribe(s)})}(this.connectionState$.pipe(Ve(e=>"CONNECTED"===e),Ue(()=>this.db.transaction(e,t,n)),Bn(e=>{return this.logerr(e),r=j(t=()=>e)?t:function(){return t},i=function(e){return e.error(r())},new le(n?function(e){return n.schedule(i,0,e)}:i);var t,n,r,i})))}reconnectDB(e){e&&this.logerr(`${Qt.handledErrorPrefix} ${JSON.stringify(e)}`),this.connectDB()}}const $n={capture:!0,passive:!0};class Fn{env;get visible(){return this.isPageVisible()}hiddenPropName="hidden";visibilityStatePropName="visibilityState";visibilityEventName="visibilitychange";constructor(e){this.env=e,this.configureVisibilityListener()}onVisibilityChange(){const e=this.env.win.document;let t=new pe;return this.configureVisibilityListener()&&(t=Ot(e,this.visibilityEventName).pipe(Ue(()=>this.isPageVisible()))),this.fullVisibilityAPISupport()||(t=qe(t,this.legacyVisibilityEvents())),t.pipe(Dt())}legacyOnUnload(){const e=this.env.win;return qe(this.legacyPageHide(),Ot(e,"beforeunload",$n),Ot(e,"unload",$n))}legacyPageHide(){return Ot(this.env.win,"pagehide",$n)}legacyVisibilityEvents(){return qe(this.legacyOnUnload().pipe(Ue(()=>!1)),Ot(this.env.win,"pageshow",$n).pipe(Ue(()=>!0)),Ot(this.env.win,"focus",$n).pipe(Ue(()=>!0))).pipe(Dt())}isPageVisible(){const e=this.env.doc;return"string"==typeof e[this.visibilityStatePropName]&&e[this.visibilityStatePropName]?"visible"===e[this.visibilityStatePropName]:"boolean"==typeof e[this.hiddenPropName]?!e[this.hiddenPropName]:!this.env.win.document.hasFocus||this.env.win.document.hasFocus()}configureVisibilityListener(){const e=["","ms","webkit","moz","o"],t=this.env.doc;for(const n of e){const e=n?`${n}Hidden`:"hidden",r=n?`${n}VisibilityState`:"visibilityState",i=(n||"")+"visibilitychange";if(e in t||r in t)return this.hiddenPropName=e,this.visibilityEventName=i,this.visibilityStatePropName=r,!0}return!1}fullVisibilityAPISupport(){const e=this.env.doc,t=this.env.win.navigator.userAgent;return"string"==typeof e.visibilityState&&"boolean"==typeof e.hidden&&void 0!==e.onvisibilitychange&&!/Safari/i.test(t)}}const zn=(new d).provide(function(e){return e.useFactory(ut,e=>e,[t]).useClass(an,an,[sn,fn]).useFactory(mn,(e,t,n,r,i)=>new mn(e(n.sessionStorageType),t,n,r,i),[m,S,ut,fn,Fn]).useFactory(v,async(e,t)=>await e.supported()?e:t,[an,mn]).useClass(rn,rn,[]).useClass(gn,gn,[]).useFactory(T,(e,t)=>new T(e(t.sessionStorageType),t),[m,ut]).useClass(vn,vn,[]).useValue(f,window).useClass(sn,sn,[f]).useClass(S,S,[sn]).useClass(bn,bn,[Fn,sn,S,T,ut,wn]).useClass(Sn,Sn,[sn]).useClass(En,En,[sn,_n]).useClass(fn,fn,[S,sn]).useClass(_n,_n,[sn]).useClass(kn,kn,[sn,gn,Tn,ut]).useClass(Cn,Cn,[y]).useFactory(y,(e,t,n,r)=>new kn(e,t,n,{...r,storagePrefix:""}),[sn,gn,Tn,ut]).useFactory(b,(e,t,n,r)=>new kn(e,t,n,{...r,storagePrefix:r.storagePrefix}),[sn,gn,Tn,ut]).useFactory(wn,(e,t,n,r,i)=>new wn(e,t(n.sessionStorageType),r,n,i,_.External),[fn,m,ut,b,Cn]).useClass(Nn,Nn,[sn]).useFactory(Pn,(e,t,n,r)=>new Pn(n(r.hashStoreStorageType),e,t),[rn,S,m,ut]).useClass(In,In,[sn]).useClass(Ln,Ln,[_n]).useFactory(An,(e,t,n,r)=>new An(e,t(n.trafficSourceDetectorStorageType),r),[Ln,m,ut,_n]).useClass(Mn,Mn,[sn,ut,Dn,vn]).useClass(jn,jn,[sn,ut,Dn,vn]).useFactory(g,(e,t,n)=>new Vn("pulse-cookie-changes",e(n.sessionStorageType),t),[m,sn,ut]).useClass(Tn,Tn,[g,sn]).useClass(kn,kn,[sn,gn,Tn,ut]).useClass(Dn,Dn,[sn]).useClass(Hn,Hn,[sn]).useFactory(m,(e,t,n,r)=>i=>{if(!o(r.win))return e;switch(i){case"memory":return e;case"persistent":return n;case"tab":return t}},[vn,jn,Mn,sn]).useClass(Fn,Fn,[sn]).useFactory(ye,(e,t)=>new ye(e(t.sessionStorageType),t.stateStorageKey,_.All),[m,ut]).useClass(p,p,[])}).beforeInit(function(e){const t={...Qt,...e,initialDocURL:window.paa?.idu};return"standard"!==t.mode&&(t.trafficSourceDetectorStorageType="memory"),t});function qn(e){if("string"!=typeof e)throw new Error("Invalid input. Input must be a string");const t=e.match(/(\/?)(.+)\1([a-z]*)/i);return t?t[3]&&!/^(?!.*?(.).*?\1)[gmixXsuUAJ]+$/.test(t[3])?RegExp(e):new RegExp(t[2],t[3]):null}class Kn{value;optimized;constructor(e,t){this.value=e,this.optimized=t}toString(){return this.value}}class Wn{cssPath(e,t=!1){try{if(e.nodeType!==Node.ELEMENT_NODE)return"";const n=[];let r=e;for(;r;){const i=this.createStep(r,Boolean(t),r===e);if(!i)break;if(n.push(i),i?.optimized)break;r=r.parentNode}return n.reverse(),n.join(" > ")}catch(e){return console.error(e),""}}createStep(e,t,n){if(e.nodeType!==Node.ELEMENT_NODE)return null;const r=e.getAttribute("id");if(t){if(r)return new Kn(this.idSelector(r),!0);const t=e.nodeName.toLowerCase();if("body"===t||"head"===t||"html"===t)return new Kn(e.nodeName.toLowerCase(),!0)}const i=e.nodeName.toLowerCase();if(r)return new Kn(i.toLowerCase()+this.idSelector(r),!0);const s=e.parentNode;if(!s||s.nodeType===Node.DOCUMENT_NODE)return new Kn(i.toLowerCase(),!0);const o=this.prefixedElementClassNames(e),a=s.children;let c=!1,u=!1,l=-1;for(let t=0;(-1===l||!u)&&t<a.length;++t){const n=a[t];if(n===e){l=t;continue}if(u)continue;if(n?.nodeName.toLowerCase()!==i.toLowerCase())continue;c=!0;const r=o;let s=0;for(const e in r)++s;if(0===s){u=!0;continue}const h=this.prefixedElementClassNames(n);for(const e of h)if(!r.indexOf(e)&&(delete r[e],! --s)){u=!0;break}}let h=i.toLowerCase();if(n&&"input"===i.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(h+='[type="'+e.getAttribute("type")+'"]'),u)h+=":nth-child("+(l+1)+")";else if(c)for(const e in o)h+="."+this.escapeIdentifierIfNeeded(o[e]?.substr(1)||"");return new Kn(h,!1)}prefixedElementClassNames(e){const t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map(e=>"$"+e):[]}idSelector(e){return"#"+this.escapeIdentifierIfNeeded(e)}escapeIdentifierIfNeeded(e){if(this.isCSSIdentifier(e))return e;const t=/^(?:[0-9]|-[0-9-]?)/.test(e),n=e.length-1;return e.replace(/./g,(e,r)=>t&&0===r||!this.isCSSIdentChar(e)?this.escapeAsciiChar(e,r===n):e)}escapeAsciiChar(e,t){return"\\"+this.toHexByte(e)+(t?"":" ")}toHexByte(e){let t=e.charCodeAt(0).toString(16);return 1===t.length&&(t="0"+t),t}isCSSIdentChar(e){return!!/[a-zA-Z0-9_-]/.test(e)||e.charCodeAt(0)>=160}isCSSIdentifier(e){return/^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(e)}}var Gn;!function(e){e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden"}(Gn||(Gn={}));class Jn{visibility;visibilityState=Gn.Visible;constructor(e){this.visibility=e}init(){this.visibility.onVisibilityChange().subscribe(e=>{this.visibilityState=e?Gn.Visible:Gn.Hidden})}}class Xn{rum;env;constructor(e,t){this.rum=e,this.env=t}init(e){this.rum.subscribe(e.config.rumReport,e.config.rumReportOnce).subscribe(e=>{this.env.win.dataLayer?.push({pulse:"event",event:"rum",data:e})})}}const Yn=new Set(["plain/text","text/html","text/css","text/xml","text/csv","text/javascript","application/json","application/ld+json","application/xml","application/xhtml+xml","application/atom+xml","application/javascript","application/x-javascript","image/svg+xml"]),Zn=new Set(["font/woff2","font/ttf","image/gif","image/png","image/jpg","image/jpeg","image/webp","image/bmp"]),Qn=new Set([...Yn.values(),...Zn.values()]);function er(e,t){try{return new URL("string"==typeof e?e:e.href,t.win.location.href).href}catch(t){return"string"==typeof e?e:"object"==typeof e&&e.href?e.href:void console.warn(t)}}function tr(e){if(e)return e.toLowerCase().split(";").map(e=>e.trim())[0]}function nr(e,t){try{if(null==e||""===e)return 0;if("string"==typeof e)return new t.Blob([e]).size;if(e instanceof t.Blob)return e.size;if((e instanceof t.ArrayBuffer||t.ArrayBuffer.isView(e))&&"number"==typeof e.byteLength)return e.byteLength;if(e instanceof t.URLSearchParams)return nr(e.toString(),t);if("object"==typeof e)return nr(JSON.stringify(e),t)}catch{}}function rr(e,t,n,r){if(t?.body&&!function(e,t){return"ReadableStream"in t&&e instanceof t.ReadableStream}(t.body,r.win)){const n=new u;try{const e=nr(t.body,r.win);n.resolve({size:e,start:-1,end:-1,cancelled:!1})}catch(e){n.reject(e)}return{wrappedRequest:new Request(e,t),bodyStats:n.waitUntilResolved()}}if("object"==typeof e&&e.body instanceof ReadableStream){const{wrappedStream:i,complete:s}=function(e,t,n){const r=new u,i=new u;let s=-1;const o=new n.ReadableStream({start(r){s=t.hrt();const o=e.getReader();let a=0;o.read().then(({done:e,value:o})=>{if(e){const e=t.hrt();return i.resolve({start:s,end:e,size:a,cancelled:!1}),void r.close()}try{a+=nr(o,n)??0}catch(e){console.error(e)}r.enqueue(o)}).catch(e=>{i.reject(e),r.error(e)})},cancel(n){e.cancel(n);const r=t.hrt();i.resolve({start:s,end:r,cancelled:!0})}});return{started:r.waitUntilResolved(),complete:i.waitUntilResolved(),wrappedStream:o}}(e.body,n,r.win),o={cache:e?.cache,credentials:e?.credentials,headers:e?.headers,integrity:e?.integrity,keepalive:e?.keepalive,method:e?.method,mode:e?.mode,redirect:e?.redirect,referrer:e?.referrer,referrerPolicy:e?.referrerPolicy,signal:e?.signal,...t||{},body:i};return{wrappedRequest:new Request(e,o),bodyStats:s}}return{wrappedRequest:new Request(e,t),bodyStats:Promise.resolve(void 0)}}class ir{date;env;reportStream=new pe;patched=!1;constructor(e,t){this.date=e,this.env=t}requests(){return this.patchFetch(),this.reportStream.asObservable()}supported(){return"ReadableStream"in this.env.win&&"ArrayBuffer"in this.env.win&&"Request"in this.env.win&&"Response"in this.env.win&&"function"==typeof this.env.win.fetch}patchFetch(){if(this.patched||!this.supported())return;const e=this.env.win,t=e.fetch.bind(e);this.env.win.fetch=async(e,n)=>this.monitoredFetch(e,n,t),this.patched=!0}async monitoredFetch(e,t,n){const r={url:"",method:"",start:0,fetchEnd:0,end:0,responseStatus:0,initiator:"fetch"};let i,s,o;try{i=rr(e,t,this.date,this.env),r.url=er(i.wrappedRequest.url,this.env)||"",r.method=i.wrappedRequest.method.toUpperCase(),i.bodyStats.then(e=>{r.requestBodySize=e?.size}).catch(e=>{console.error(e)}),i.wrappedRequest.signal?.addEventListener("abort",()=>{r.aborted=!0}),r.start=this.date.hrt(),s=await n(i.wrappedRequest),r.fetchEnd=this.date.hrt();try{r.responseBodySize=s.headers.has("content-length")?Number(s.headers.get("content-length")):void 0;("basic"===s.type||"cors"===s.type||"default"===s.type)&&r.responseContentType&&!Number.isSafeInteger(r.responseBodySize)&&Qn.has(r.responseContentType)&&(o=s.clone())}catch{}return s}finally{r.fetchEnd=s?r.fetchEnd:this.date.hrt(),on(0).then(()=>this.reportResponse(s,o,r)).catch(e=>console.error(e))}}async reportResponse(e,t,n){if(n){if(e)try{const r=e.headers?.get("content-type");if(n.responseContentType=tr(r),n.redirected=e.redirected,n.responseMode=e.type,n.responseStatus=e.status,!Number.isSafeInteger(n.responseBodySize)&&t)try{const e=await t.blob();n.responseBodySize=e.size}catch{}}catch{}n.end=this.date.hrt(),this.reportStream.next(n)}}}function sr(e,t){if(!t||!e)return!1;if(Yn.has(t))return!0;if(Zn.has(t))try{return e instanceof Blob||e instanceof ArrayBuffer}catch(e){console.error(e)}return!1}function or(e,t){const n=new pe;function r(r){if(r.___pulse)return r.___pulse;const i={requestHeaders:new Headers,hasError:!1};return r.___pulse=i,r.addEventListener("error",()=>{i.hasError=!0}),r.addEventListener("timeout",()=>{i.hasError=!0,i.aborted=!0}),r.addEventListener("loadend",s=>{i.end=e.hrt(),on(0).then(()=>function(r,i,s){const o=tr(i.requestHeaders.get("content-type"));let a,c,u;sr(i.requestBody,o)&&(a=nr(i.requestBody,t.win));let l={url:i.url,method:i.method,start:i.start,fetchEnd:i.end,end:i.end,aborted:Boolean(i.aborted),requestBodySize:a,requestContentType:o,responseStatus:r.status,initiator:"xhr"};if(i.hasError)n.next(l);else{try{u=tr(r.getResponseHeader("content-type"))}catch(e){console.error(e)}if(s.lengthComputable&&"number"==typeof s.total)c=s.total;else try{const e=Number(r.getResponseHeader("content-length"));Number.isSafeInteger(e)&&(l.responseBodySize=e)}catch(e){console.error(e)}"number"!=typeof l.responseBodySize&&sr(r.response,u)&&(c=nr(r.response,t.win)),l={...l,responseBodySize:c,responseContentType:u,end:e.hrt()},n.next(l)}}(r,i,s)).catch(e=>console.error(e))}),i}function i(e,t){const n=XMLHttpRequest.prototype[e];"function"==typeof n&&(XMLHttpRequest.prototype[e]=function(...e){const i=this,s=r(i);return t(i,s,n.bind(i),...e)})}return i("setRequestHeader",(e,t,n,...r)=>{const[i,s]=r;try{t.requestHeaders.set(i,s)}catch(e){console.error(e)}n.apply(e,r)}),i("open",(e,n,r,...i)=>{const[s,o]=i;r.apply(e,i),n.method=s,n.url=er(o,t)||""}),i("send",(t,n,r,...i)=>{n.start=e.hrt(),r.apply(t,i)}),i("abort",(e,t,n)=>{t.aborted=!0,n.apply(e)}),n.asObservable()}class ar{date;env;stream;constructor(e,t){this.date=e,this.env=t}requests(){return this.stream||(this.stream=or(this.date,this.env)),this.stream}}class cr{value;optimized;constructor(e,t=!1){this.value=e,this.optimized=t}toString(){return this.value}}class ur{xPath(e,t){if(e.nodeType===Node.DOCUMENT_NODE)return"/";const n=[];let r=e;for(;r;){const e=this.xPathValue(r,t);if(!e)break;if(n.push(e),e.optimized)break;r=r.parentNode}return n.reverse(),(n.length&&n[0]?.optimized?"":"/")+n.join("/")}xPathValue(e,t){const n=this.xPathIndex(e);let r;if(-1===n)return null;switch(e.nodeType){case Node.ELEMENT_NODE:{const n=e;if(t&&n.getAttribute("id"))return new cr('//*[@id="'+n.getAttribute("id")+'"]',!0);r=n.localName;break}case Node.ATTRIBUTE_NODE:r="@"+e.nodeName;break;case Node.TEXT_NODE:case Node.CDATA_SECTION_NODE:r="text()";break;case Node.PROCESSING_INSTRUCTION_NODE:r="processing-instruction()";break;case Node.COMMENT_NODE:r="comment()";break;case Node.DOCUMENT_NODE:default:r=""}return n>0&&(r+="["+n+"]"),new cr(r,e.nodeType===Node.DOCUMENT_NODE)}xPathIndex(e){const t=e.parentNode?e.parentNode.children:null;if(!t)return 0;let n=!1;for(const r of t)if(this.areNodesSimilar(e,r)&&r!==e){n=!0;break}if(!n)return 0;let r=1;for(const n of t)if(this.areNodesSimilar(e,n)){if(n===e)return r;++r}return-1}areNodesSimilar(e,t){if(e===t)return!0;if(e.nodeType===Node.ELEMENT_NODE&&t.nodeType===Node.ELEMENT_NODE)return e.localName===t.localName;if(e.nodeType===t.nodeType)return!0;return(e.nodeType===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:e.nodeType)===(t.nodeType===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:t.nodeType)}}class lr{pipesHost;config;constructor(e,t){this.pipesHost=e,this.config=t}registerPipes(){const e=this.config.transformPipes||[],t=this.config.enrichmentPipes||[];e.forEach(e=>this.pipesHost.registerTransformSet(e)),t.forEach(e=>this.pipesHost.registerEnrichmentSet(e))}}class hr{visibilityChangePlugin;config;rumPlugin;pluginHost;constructor(e,t,n,r){this.visibilityChangePlugin=e,this.config=t,this.rumPlugin=n,this.pluginHost=r}registerPlugins(){[this.visibilityChangePlugin,this.rumPlugin,...this.config.plugins||[]].forEach(e=>this.pluginHost.register(e))}}function dr(e){for(const t of e)if("object"==typeof t&&Array.isArray(t.name))for(let e=0;e<t.name.length;e++){const n=t.name[e];if("string"==typeof n&&n.startsWith("/")){const r=qn(n);r instanceof RegExp&&(t.name[e]=r)}}}const pr=(new d).provide(function(e){return e.useFactory(lt,e=>e,[t]).useFactory(rt,(e,t)=>e.win[t.dataLayerKey],[sn,lt]).useFactory(nt,e=>e.win.pulse?.q,[sn]).useClass(tt,tt,[]).useClass(st,at,[]).useClass(it,at,[]).useClass(Jn,Jn,[Fn]).useClass(Ye,Ye,[Qe,et]).useClass(et,et,[ir,ar,Qe,S,sn]).useClass(Wn,Wn,[]).useClass(Qe,Qe,[sn,Wn,S,Fn]).useClass(ir,ir,[S,sn]).useClass(ar,ar,[S,sn]).useClass(hr,hr,[Jn,lt,Xn,tt]).useClass(ur,ur,[]).useClass(lr,lr,[st,lt])}).beforeInit(function(e){const t={...en,...e};return function(e){e.rumReport=e.rumReport||[],e.rumReportOnce=e.rumReportOnce||[],dr(e.rumReport),dr(e.rumReportOnce)}(t),t});const fr=(new d).provide(function(e){return e.useFactory(ct,e=>e,[t]).useClass(rn,rn,[])}).beforeInit(function(e){const t={...Zt,...e};return"standard"!==t.mode&&(t.hashStoreStorageType="memory"),t}),mr=window,gr=mr.pulseInit||[],yr=mr.pulseReady||[];mr.pulseInit=gr,mr.pulseReady=yr;const vr=gr.push.bind(gr),br=yr.push.bind(yr);function wr(...e){for(const t of e)mr.pulse?.tracker||mr.pulse?.settingsFactory?t.onReady():(vr(t),br(t));return gr.length}function Sr(e,t){if(t)return void console.warn(t,e);const n=gr,r=yr;for(const e of n)gr.splice(gr.indexOf(e),1),e.onReady();for(const e of r)yr.splice(yr.indexOf(e),1),e.onReady()}gr.push=wr,yr.push=wr;const Er=window;Er.pulse||(Er.pulse={}),Er.pulse.init=async function(e,t,n,r,i,s,o){if(globalThis.pulse?.tracker||globalThis.pulse?._tracker)return void console.warn("Pulse is already initialized");const a={...undefined,...e},c=await(new d).import(fr).import(zn).import(pr).import(nn).bootstrap(a),u=await c.get(Gt);window.dataLayer=window.dataLayer||[],function(e,t,n,r,i,s,o){const a=window;a.pulse&&(a.pulse._transport=t,a.pulse._route=n,a.pulse._attributes=r,a.pulse._settings=i,a.pulse._experiments=s,a.pulse._segments=o),a?.pulse?._initialized&&a?.pulse?.tracker||(a.pulse.tracker=e,a.pulse._initialized=!0,Sr("tracker")),a.pulse.tracker}(u,n,r,t,i,s,o)},Sr()})()})();
//# sourceMappingURL=pulse.bundle.mini.esnext.938aae1c93e79d765b31.js.map